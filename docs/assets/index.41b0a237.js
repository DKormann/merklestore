var Fr=Object.defineProperty;var Cr=(e,t,r)=>t in e?Fr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var y=(e,t,r)=>(Cr(e,typeof t!="symbol"?t+"":t,r),r),nt=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var s=(e,t,r)=>(nt(e,t,"read from private field"),r?r.call(e):t.get(e)),T=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},d=(e,t,r,n)=>(nt(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);var h=(e,t,r)=>(nt(e,t,"access private method"),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();var sr=Pr,N=[],Zt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Ee=0,Br=Zt.length;Ee<Br;++Ee)N[Ee]=Zt[Ee];function kr(e){return N[e>>18&63]+N[e>>12&63]+N[e>>6&63]+N[e&63]}function Er(e,t,r){for(var n,i=[],a=t;a<r;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(e[a+2]&255),i.push(kr(n));return i.join("")}function Pr(e){for(var t,r=e.length,n=r%3,i=[],a=16383,u=0,o=r-n;u<o;u+=a)i.push(Er(e,u,u+a>o?o:u+a));return n===1?(t=e[r-1],i.push(N[t>>2]+N[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],i.push(N[t>>10]+N[t>>4&63]+N[t<<2&63]+"=")),i.join("")}var I,b,Yt,ce=(Yt=class{constructor(e){T(this,I,void 0);T(this,b,0);d(this,I,new DataView(e.buffer)),d(this,b,e.byteOffset)}get offset(){return s(this,b)}readUInt8Array(){const e=this.readU32(),t=new Uint8Array(s(this,I).buffer,s(this,b),e);return d(this,b,s(this,b)+e),t}readBool(){const e=s(this,I).getUint8(s(this,b));return d(this,b,s(this,b)+1),e!==0}readByte(){const e=s(this,I).getUint8(s(this,b));return d(this,b,s(this,b)+1),e}readBytes(e){const t=new DataView(s(this,I).buffer,s(this,b),e);return d(this,b,s(this,b)+e),new Uint8Array(t.buffer)}readI8(){const e=s(this,I).getInt8(s(this,b));return d(this,b,s(this,b)+1),e}readU8(){const e=s(this,I).getUint8(s(this,b));return d(this,b,s(this,b)+1),e}readI16(){const e=s(this,I).getInt16(s(this,b),!0);return d(this,b,s(this,b)+2),e}readU16(){const e=s(this,I).getUint16(s(this,b),!0);return d(this,b,s(this,b)+2),e}readI32(){const e=s(this,I).getInt32(s(this,b),!0);return d(this,b,s(this,b)+4),e}readU32(){const e=s(this,I).getUint32(s(this,b),!0);return d(this,b,s(this,b)+4),e}readI64(){const e=s(this,I).getBigInt64(s(this,b),!0);return d(this,b,s(this,b)+8),e}readU64(){const e=s(this,I).getBigUint64(s(this,b),!0);return d(this,b,s(this,b)+8),e}readU128(){const e=s(this,I).getBigUint64(s(this,b),!0),t=s(this,I).getBigUint64(s(this,b)+8,!0);return d(this,b,s(this,b)+16),(t<<BigInt(64))+e}readI128(){const e=s(this,I).getBigUint64(s(this,b),!0),t=s(this,I).getBigInt64(s(this,b)+8,!0);return d(this,b,s(this,b)+16),(t<<BigInt(64))+e}readU256(){const e=s(this,I).getBigUint64(s(this,b),!0),t=s(this,I).getBigUint64(s(this,b)+8,!0),r=s(this,I).getBigUint64(s(this,b)+16,!0),n=s(this,I).getBigUint64(s(this,b)+24,!0);return d(this,b,s(this,b)+32),(n<<BigInt(3*64))+(r<<BigInt(2*64))+(t<<BigInt(1*64))+e}readI256(){const e=s(this,I).getBigUint64(s(this,b),!0),t=s(this,I).getBigUint64(s(this,b)+8,!0),r=s(this,I).getBigUint64(s(this,b)+16,!0),n=s(this,I).getBigInt64(s(this,b)+24,!0);return d(this,b,s(this,b)+32),(n<<BigInt(3*64))+(r<<BigInt(2*64))+(t<<BigInt(1*64))+e}readF32(){const e=s(this,I).getFloat32(s(this,b),!0);return d(this,b,s(this,b)+4),e}readF64(){const e=s(this,I).getFloat64(s(this,b),!0);return d(this,b,s(this,b)+8),e}readString(){const e=this.readU32(),t=new Uint8Array(s(this,I).buffer,s(this,b),e),n=new TextDecoder("utf-8").decode(t);return d(this,b,s(this,b)+e),n}},I=new WeakMap,b=new WeakMap,Yt),O,z,m,C,E,Qt,j=(Qt=class{constructor(e){T(this,C);T(this,O,void 0);T(this,z,void 0);T(this,m,0);d(this,O,new Uint8Array(e)),d(this,z,new DataView(s(this,O).buffer))}toBase64(){return sr(s(this,O).subarray(0,s(this,m)))}getBuffer(){return s(this,O).slice(0,s(this,m))}writeUInt8Array(e){const t=e.length;h(this,C,E).call(this,4+t),this.writeU32(t),s(this,O).set(e,s(this,m)),d(this,m,s(this,m)+e.length)}writeBool(e){h(this,C,E).call(this,1),s(this,z).setUint8(s(this,m),e?1:0),d(this,m,s(this,m)+1)}writeByte(e){h(this,C,E).call(this,1),s(this,z).setUint8(s(this,m),e),d(this,m,s(this,m)+1)}writeI8(e){h(this,C,E).call(this,1),s(this,z).setInt8(s(this,m),e),d(this,m,s(this,m)+1)}writeU8(e){h(this,C,E).call(this,1),s(this,z).setUint8(s(this,m),e),d(this,m,s(this,m)+1)}writeI16(e){h(this,C,E).call(this,2),s(this,z).setInt16(s(this,m),e,!0),d(this,m,s(this,m)+2)}writeU16(e){h(this,C,E).call(this,2),s(this,z).setUint16(s(this,m),e,!0),d(this,m,s(this,m)+2)}writeI32(e){h(this,C,E).call(this,4),s(this,z).setInt32(s(this,m),e,!0),d(this,m,s(this,m)+4)}writeU32(e){h(this,C,E).call(this,4),s(this,z).setUint32(s(this,m),e,!0),d(this,m,s(this,m)+4)}writeI64(e){h(this,C,E).call(this,8),s(this,z).setBigInt64(s(this,m),e,!0),d(this,m,s(this,m)+8)}writeU64(e){h(this,C,E).call(this,8),s(this,z).setBigUint64(s(this,m),e,!0),d(this,m,s(this,m)+8)}writeU128(e){h(this,C,E).call(this,16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),r=e>>BigInt(64);s(this,z).setBigUint64(s(this,m),t,!0),s(this,z).setBigUint64(s(this,m)+8,r,!0),d(this,m,s(this,m)+16)}writeI128(e){h(this,C,E).call(this,16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),r=e>>BigInt(64);s(this,z).setBigInt64(s(this,m),t,!0),s(this,z).setBigInt64(s(this,m)+8,r,!0),d(this,m,s(this,m)+16)}writeU256(e){h(this,C,E).call(this,32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),r=e&t,n=e>>BigInt(64*1)&t,i=e>>BigInt(64*2)&t,a=e>>BigInt(64*3);s(this,z).setBigUint64(s(this,m)+8*0,r,!0),s(this,z).setBigUint64(s(this,m)+8*1,n,!0),s(this,z).setBigUint64(s(this,m)+8*2,i,!0),s(this,z).setBigUint64(s(this,m)+8*3,a,!0),d(this,m,s(this,m)+32)}writeI256(e){h(this,C,E).call(this,32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),r=e&t,n=e>>BigInt(64*1)&t,i=e>>BigInt(64*2)&t,a=e>>BigInt(64*3);s(this,z).setBigUint64(s(this,m)+8*0,r,!0),s(this,z).setBigUint64(s(this,m)+8*1,n,!0),s(this,z).setBigUint64(s(this,m)+8*2,i,!0),s(this,z).setBigInt64(s(this,m)+8*3,a,!0),d(this,m,s(this,m)+32)}writeF32(e){h(this,C,E).call(this,4),s(this,z).setFloat32(s(this,m),e,!0),d(this,m,s(this,m)+4)}writeF64(e){h(this,C,E).call(this,8),s(this,z).setFloat64(s(this,m),e,!0),d(this,m,s(this,m)+8)}writeString(e){const r=new TextEncoder().encode(e);this.writeU32(r.length),h(this,C,E).call(this,r.length),s(this,O).set(r,s(this,m)),d(this,m,s(this,m)+r.length)}},O=new WeakMap,z=new WeakMap,m=new WeakMap,C=new WeakSet,E=function(e){const t=s(this,m)+e+1;if(t<=s(this,O).length)return;let r=s(this,O).length*2;r<t&&(r=t);const n=new Uint8Array(r);n.set(s(this,O)),d(this,O,n),d(this,z,new DataView(s(this,O).buffer))},Qt);function jt(e,t){if(e===t)return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let i of r)if(!n.includes(i)||!jt(e[i],t[i]))return!1;return!0}function ar(e){return Array.prototype.map.call(e.reverse(),t=>("00"+t.toString(16)).slice(-2)).join("")}function xr(e){if(e.length!=16)throw new Error(`Uint8Array is not 16 bytes long: ${e}`);return new ce(e).readU128()}function Or(e){if(e.length!=32)throw new Error(`Uint8Array is not 32 bytes long: [${e}]`);return new ce(e).readU256()}function cr(e){e.startsWith("0x")&&(e=e.slice(2));let t=e.match(/.{1,2}/g)||[],r=Uint8Array.from(t.map(n=>parseInt(n,16)));return r.length!=32?new Uint8Array(0):r.reverse()}function Rr(e){return xr(cr(e))}function Mr(e){return Or(cr(e))}function or(e){let t=new j(16);return t.writeU128(e),t.getBuffer()}function Nr(e){return ar(or(e))}function lr(e){let t=new j(32);return t.writeU256(e),t.getBuffer()}function Dr(e){return ar(lr(e))}var st=class xe{constructor(t){y(this,"data");this.data=t}get __connection_id__(){return this.data}isZero(){return this.data===BigInt(0)}static nullIfZero(t){return t.isZero()?null:t}static random(){function t(){return Math.floor(Math.random()*255)}let r=BigInt(0);for(let n=0;n<16;n++)r=r<<BigInt(8)|BigInt(t());return new xe(r)}isEqual(t){return this.data==t.data}toHexString(){return Nr(this.data)}toUint8Array(){return or(this.data)}static fromString(t){return new xe(Rr(t))}static fromStringOrNull(t){let r=xe.fromString(t);return r.isZero()?null:r}},Z,qr=(Z=class{constructor(t){y(this,"__time_duration_micros__");this.__time_duration_micros__=t}get micros(){return this.__time_duration_micros__}get millis(){return Number(this.micros/Z.MICROS_PER_MILLIS)}static fromMillis(t){return new Z(BigInt(t)*Z.MICROS_PER_MILLIS)}},y(Z,"MICROS_PER_MILLIS",1000n),Z),R,Lr=(R=class{constructor(t){y(this,"__timestamp_micros_since_unix_epoch__");this.__timestamp_micros_since_unix_epoch__=t}get microsSinceUnixEpoch(){return this.__timestamp_micros_since_unix_epoch__}static now(){return R.fromDate(new Date)}static fromDate(t){const r=t.getTime(),n=BigInt(r)*R.MICROS_PER_MILLIS;return new R(n)}toDate(){const r=this.__timestamp_micros_since_unix_epoch__/R.MICROS_PER_MILLIS;if(r>BigInt(Number.MAX_SAFE_INTEGER)||r<BigInt(Number.MIN_SAFE_INTEGER))throw new RangeError("Timestamp is outside of the representable range of JS's Date");return new Date(Number(r))}},y(R,"MICROS_PER_MILLIS",1000n),y(R,"UNIX_EPOCH",new R(0n)),R),$r=class pr{constructor(t){y(this,"data");this.data=typeof t=="string"?Mr(t):t}get __identity__(){return this.data}isEqual(t){return this.toHexString()===t.toHexString()}toHexString(){return Dr(this.data)}toUint8Array(){return lr(this.data)}static fromString(t){return new pr(t)}},at;(e=>{function t(){return c.createSumType([new _("Interval",c.createU64Type()),new _("Time",c.createU64Type())])}e.getAlgebraicType=t;function r(i){switch(i.tag){case"Interval":return{Interval:i.value};case"Time":return{Time:i.value};default:throw"unreachable"}}e.serialize=r,e.Interval=i=>({tag:"Interval",value:i}),e.Time=i=>({tag:"Time",value:i});function n(i){let a=i.asSumValue();switch(a.tag){case 0:return{tag:"Interval",value:a.value.asBigInt()};case 1:return{tag:"Time",value:a.value.asBigInt()};default:throw"unreachable"}}e.fromValue=n})(at||(at={}));var Hr=at,_=class{constructor(e,t){y(this,"name");y(this,"algebraicType");this.name=e,this.algebraicType=t}},Vr=class{constructor(e){y(this,"variants");y(this,"serialize",(e,t)=>{if(this.variants.length==2&&this.variants[0].name==="some"&&this.variants[1].name==="none")t!=null?(e.writeByte(0),this.variants[0].algebraicType.serialize(e,t)):e.writeByte(1);else{let r=t.tag;const n=this.variants.findIndex(i=>i.name===r);if(n<0)throw`Can't serialize a sum type, couldn't find ${t.tag} tag`;e.writeU8(n),this.variants[n].algebraicType.serialize(e,t.value)}});y(this,"deserialize",e=>{let t=e.readU8();if(this.variants.length==2&&this.variants[0].name==="some"&&this.variants[1].name==="none"){if(t===0)return this.variants[0].algebraicType.deserialize(e);if(t===1)return;throw`Can't deserialize an option type, couldn't find ${t} tag`}else{let r=this.variants[t],n=r.algebraicType.deserialize(e);return{tag:r.name,value:n}}});this.variants=e}},p=class{constructor(e,t){y(this,"name");y(this,"algebraicType");this.name=e,this.algebraicType=t}},Wr=class{constructor(e){y(this,"elements");y(this,"serialize",(e,t)=>{for(let r of this.elements)r.algebraicType.serialize(e,t[r.name])});y(this,"deserialize",e=>{let t={};if(this.elements.length===1){if(this.elements[0].name==="__time_duration_micros__")return new qr(e.readI64());if(this.elements[0].name==="__timestamp_micros_since_unix_epoch__")return new Lr(e.readI64());if(this.elements[0].name==="__identity__")return new $r(e.readU256());if(this.elements[0].name==="__connection_id__")return new st(e.readU128())}for(let r of this.elements)t[r.name]=r.algebraicType.deserialize(e);return t});this.elements=e}isEmpty(){return this.elements.length===0}intoMapKey(e){if(this.elements.length===1){if(this.elements[0].name==="__time_duration_micros__")return e.__time_duration_micros__;if(this.elements[0].name==="__timestamp_micros_since_unix_epoch__")return e.__timestamp_micros_since_unix_epoch__;if(this.elements[0].name==="__identity__")return e.__identity__;if(this.elements[0].name==="__connection_id__")return e.__connection_id__}const t=new j(10);return this.serialize(t,e),t.toBase64()}},Kr=class{constructor(e,t){y(this,"keyType");y(this,"valueType");this.keyType=e,this.valueType=t}},H,re,v,oe,F,be,ct,me,ot,we,lt,c=(oe=class{constructor(){T(this,H);T(this,be);T(this,me);T(this,we);y(this,"type");y(this,"type_")}get product(){if(this.type!==l.ProductType)throw"product type was requested, but the type is not ProductType";return this.type_}set product(t){h(this,H,re).call(this,l.ProductType,t)}get sum(){if(this.type!==l.SumType)throw"sum type was requested, but the type is not SumType";return this.type_}set sum(t){h(this,H,re).call(this,l.SumType,t)}get array(){if(this.type!==l.ArrayType)throw"array type was requested, but the type is not ArrayType";return this.type_}set array(t){h(this,H,re).call(this,l.ArrayType,t)}get map(){if(this.type!==l.MapType)throw"map type was requested, but the type is not MapType";return this.type_}set map(t){h(this,H,re).call(this,l.MapType,t)}static createProductType(t){return h(this,v,F).call(this,l.ProductType,new Wr(t))}static createSumType(t){return h(this,v,F).call(this,l.SumType,new Vr(t))}static createArrayType(t){return h(this,v,F).call(this,l.ArrayType,t)}static createMapType(t,r){return h(this,v,F).call(this,l.MapType,new Kr(t,r))}static createBoolType(){return h(this,v,F).call(this,l.Bool,null)}static createI8Type(){return h(this,v,F).call(this,l.I8,null)}static createU8Type(){return h(this,v,F).call(this,l.U8,null)}static createI16Type(){return h(this,v,F).call(this,l.I16,null)}static createU16Type(){return h(this,v,F).call(this,l.U16,null)}static createI32Type(){return h(this,v,F).call(this,l.I32,null)}static createU32Type(){return h(this,v,F).call(this,l.U32,null)}static createI64Type(){return h(this,v,F).call(this,l.I64,null)}static createU64Type(){return h(this,v,F).call(this,l.U64,null)}static createI128Type(){return h(this,v,F).call(this,l.I128,null)}static createU128Type(){return h(this,v,F).call(this,l.U128,null)}static createI256Type(){return h(this,v,F).call(this,l.I256,null)}static createU256Type(){return h(this,v,F).call(this,l.U256,null)}static createF32Type(){return h(this,v,F).call(this,l.F32,null)}static createF64Type(){return h(this,v,F).call(this,l.F64,null)}static createStringType(){return h(this,v,F).call(this,l.String,null)}static createBytesType(){return this.createArrayType(this.createU8Type())}static createOptionType(t){return this.createSumType([new _("some",t),new _("none",this.createProductType([]))])}static createIdentityType(){return this.createProductType([new p("__identity__",this.createU256Type())])}static createConnectionIdType(){return this.createProductType([new p("__connection_id__",this.createU128Type())])}static createScheduleAtType(){return Hr.getAlgebraicType()}static createTimestampType(){return this.createProductType([new p("__timestamp_micros_since_unix_epoch__",this.createI64Type())])}static createTimeDurationType(){return this.createProductType([new p("__time_duration_micros__",this.createI64Type())])}isProductType(){return this.type===l.ProductType}isSumType(){return this.type===l.SumType}isArrayType(){return this.type===l.ArrayType}isMapType(){return this.type===l.MapType}isIdentity(){return h(this,me,ot).call(this,"__identity__")}isConnectionId(){return h(this,me,ot).call(this,"__connection_id__")}isScheduleAt(){return this.isSumType()&&this.sum.variants.length===2&&this.sum.variants[0].name==="Interval"&&this.sum.variants[0].algebraicType.type===l.U64&&this.sum.variants[1].name==="Time"&&this.sum.variants[1].algebraicType.type===l.U64}isTimestamp(){return h(this,we,lt).call(this,"__timestamp_micros_since_unix_epoch__")}isTimeDuration(){return h(this,we,lt).call(this,"__time_duration_micros__")}intoMapKey(t){switch(this.type){case l.U8:case l.U16:case l.U32:case l.U64:case l.U128:case l.U256:case l.I8:case l.I16:case l.I64:case l.I128:case l.F32:case l.F64:case l.String:case l.Bool:return t;case l.ProductType:return this.product.intoMapKey(t);default:const r=new j(10);return this.serialize(r,t),r.toBase64()}}serialize(t,r){switch(this.type){case l.ProductType:this.product.serialize(t,r);break;case l.SumType:this.sum.serialize(t,r);break;case l.ArrayType:if(h(this,be,ct).call(this))t.writeUInt8Array(r);else{const n=this.array;t.writeU32(r.length);for(let i of r)n.serialize(t,i)}break;case l.MapType:throw new Error("not implemented");case l.Bool:t.writeBool(r);break;case l.I8:t.writeI8(r);break;case l.U8:t.writeU8(r);break;case l.I16:t.writeI16(r);break;case l.U16:t.writeU16(r);break;case l.I32:t.writeI32(r);break;case l.U32:t.writeU32(r);break;case l.I64:t.writeI64(r);break;case l.U64:t.writeU64(r);break;case l.I128:t.writeI128(r);break;case l.U128:t.writeU128(r);break;case l.I256:t.writeI256(r);break;case l.U256:t.writeU256(r);break;case l.F32:t.writeF32(r);break;case l.F64:t.writeF64(r);break;case l.String:t.writeString(r);break;default:throw new Error(`not implemented, ${this.type}`)}}deserialize(t){switch(this.type){case l.ProductType:return this.product.deserialize(t);case l.SumType:return this.sum.deserialize(t);case l.ArrayType:if(h(this,be,ct).call(this))return t.readUInt8Array();{const r=this.array,n=t.readU32();let i=[];for(let a=0;a<n;a++)i.push(r.deserialize(t));return i}case l.MapType:throw new Error("not implemented");case l.Bool:return t.readBool();case l.I8:return t.readI8();case l.U8:return t.readU8();case l.I16:return t.readI16();case l.U16:return t.readU16();case l.I32:return t.readI32();case l.U32:return t.readU32();case l.I64:return t.readI64();case l.U64:return t.readU64();case l.I128:return t.readI128();case l.U128:return t.readU128();case l.U256:return t.readU256();case l.F32:return t.readF32();case l.F64:return t.readF64();case l.String:return t.readString();default:throw new Error(`not implemented, ${this.type}`)}}},H=new WeakSet,re=function(t,r){this.type_=r,this.type=r===void 0?l.None:t},v=new WeakSet,F=function(t,r){var i;let n=new oe;return h(i=n,H,re).call(i,t,r),n},be=new WeakSet,ct=function(){return this.isArrayType()&&this.array.type==l.U8},me=new WeakSet,ot=function(t){return this.isProductType()&&this.product.elements.length===1&&(this.product.elements[0].algebraicType.type==l.U128||this.product.elements[0].algebraicType.type==l.U256)&&this.product.elements[0].name===t},we=new WeakSet,lt=function(t){return this.isProductType()&&this.product.elements.length===1&&this.product.elements[0].algebraicType.type===l.I64&&this.product.elements[0].name===t},T(oe,v),oe);(e=>{(t=>{t.SumType="SumType",t.ProductType="ProductType",t.ArrayType="ArrayType",t.MapType="MapType",t.Bool="Bool",t.I8="I8",t.U8="U8",t.I16="I16",t.U16="U16",t.I32="I32",t.U32="U32",t.I64="I64",t.U64="U64",t.I128="I128",t.U128="U128",t.I256="I256",t.U256="U256",t.F32="F32",t.F64="F64",t.String="String",t.None="None"})(e.Type||(e.Type={}))})(c||(c={}));var l=c.Type;function Gr(e,t){const r=new ce(t);return e.deserialize(r)}var pt;(e=>{e.FixedSize=i=>({tag:"FixedSize",value:i}),e.RowOffsets=i=>({tag:"RowOffsets",value:i});function t(){return c.createSumType([new _("FixedSize",c.createU16Type()),new _("RowOffsets",c.createArrayType(c.createU64Type()))])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(pt||(pt={}));var fe;(e=>{function t(){return c.createProductType([new p("sizeHint",pt.getTypeScriptAlgebraicType()),new p("rowsData",c.createArrayType(c.createU8Type()))])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(fe||(fe={}));var ut;(e=>{function t(){return c.createProductType([new p("reducer",c.createStringType()),new p("args",c.createArrayType(c.createU8Type())),new p("requestId",c.createU32Type()),new p("flags",c.createU8Type())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(ut||(ut={}));var dt;(e=>{function t(){return c.createProductType([new p("queryStrings",c.createArrayType(c.createStringType())),new p("requestId",c.createU32Type())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(dt||(dt={}));var ht;(e=>{function t(){return c.createProductType([new p("messageId",c.createArrayType(c.createU8Type())),new p("queryString",c.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(ht||(ht={}));var D;(e=>{function t(){return c.createProductType([new p("id",c.createU32Type())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(D||(D={}));var yt;(e=>{function t(){return c.createProductType([new p("query",c.createStringType()),new p("requestId",c.createU32Type()),new p("queryId",D.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(yt||(yt={}));var gt;(e=>{function t(){return c.createProductType([new p("queryStrings",c.createArrayType(c.createStringType())),new p("requestId",c.createU32Type()),new p("queryId",D.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(gt||(gt={}));var Tt;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("queryId",D.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Tt||(Tt={}));var ft;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("queryId",D.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(ft||(ft={}));var ie;(e=>{e.CallReducer=i=>({tag:"CallReducer",value:i}),e.Subscribe=i=>({tag:"Subscribe",value:i}),e.OneOffQuery=i=>({tag:"OneOffQuery",value:i}),e.SubscribeSingle=i=>({tag:"SubscribeSingle",value:i}),e.SubscribeMulti=i=>({tag:"SubscribeMulti",value:i}),e.Unsubscribe=i=>({tag:"Unsubscribe",value:i}),e.UnsubscribeMulti=i=>({tag:"UnsubscribeMulti",value:i});function t(){return c.createSumType([new _("CallReducer",ut.getTypeScriptAlgebraicType()),new _("Subscribe",dt.getTypeScriptAlgebraicType()),new _("OneOffQuery",ht.getTypeScriptAlgebraicType()),new _("SubscribeSingle",yt.getTypeScriptAlgebraicType()),new _("SubscribeMulti",gt.getTypeScriptAlgebraicType()),new _("Unsubscribe",Tt.getTypeScriptAlgebraicType()),new _("UnsubscribeMulti",ft.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(ie||(ie={}));var Me;(e=>{function t(){return c.createProductType([new p("deletes",fe.getTypeScriptAlgebraicType()),new p("inserts",fe.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Me||(Me={}));var bt;(e=>{e.Uncompressed=i=>({tag:"Uncompressed",value:i}),e.Brotli=i=>({tag:"Brotli",value:i}),e.Gzip=i=>({tag:"Gzip",value:i});function t(){return c.createSumType([new _("Uncompressed",Me.getTypeScriptAlgebraicType()),new _("Brotli",c.createArrayType(c.createU8Type())),new _("Gzip",c.createArrayType(c.createU8Type()))])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(bt||(bt={}));var Ne;(e=>{function t(){return c.createProductType([new p("tableId",c.createU32Type()),new p("tableName",c.createStringType()),new p("numRows",c.createU64Type()),new p("updates",c.createArrayType(bt.getTypeScriptAlgebraicType()))])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ne||(Ne={}));var ee;(e=>{function t(){return c.createProductType([new p("tables",c.createArrayType(Ne.getTypeScriptAlgebraicType()))])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(ee||(ee={}));var mt;(e=>{function t(){return c.createProductType([new p("databaseUpdate",ee.getTypeScriptAlgebraicType()),new p("requestId",c.createU32Type()),new p("totalHostExecutionDuration",c.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(mt||(mt={}));var wt;(e=>{e.Committed=i=>({tag:"Committed",value:i}),e.Failed=i=>({tag:"Failed",value:i}),e.OutOfEnergy={tag:"OutOfEnergy"};function t(){return c.createSumType([new _("Committed",ee.getTypeScriptAlgebraicType()),new _("Failed",c.createStringType()),new _("OutOfEnergy",c.createProductType([]))])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(wt||(wt={}));var St;(e=>{function t(){return c.createProductType([new p("reducerName",c.createStringType()),new p("reducerId",c.createU32Type()),new p("args",c.createArrayType(c.createU8Type())),new p("requestId",c.createU32Type())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(St||(St={}));var At;(e=>{function t(){return c.createProductType([new p("quanta",c.createU128Type())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(At||(At={}));var It;(e=>{function t(){return c.createProductType([new p("status",wt.getTypeScriptAlgebraicType()),new p("timestamp",c.createTimestampType()),new p("callerIdentity",c.createIdentityType()),new p("callerConnectionId",c.createConnectionIdType()),new p("reducerCall",St.getTypeScriptAlgebraicType()),new p("energyQuantaUsed",At.getTypeScriptAlgebraicType()),new p("totalHostExecutionDuration",c.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(It||(It={}));var zt;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("update",ee.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(zt||(zt={}));var _t;(e=>{function t(){return c.createProductType([new p("identity",c.createIdentityType()),new p("token",c.createStringType()),new p("connectionId",c.createConnectionIdType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(_t||(_t={}));var vt;(e=>{function t(){return c.createProductType([new p("tableName",c.createStringType()),new p("rows",fe.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(vt||(vt={}));var Ut;(e=>{function t(){return c.createProductType([new p("messageId",c.createArrayType(c.createU8Type())),new p("error",c.createOptionType(c.createStringType())),new p("tables",c.createArrayType(vt.getTypeScriptAlgebraicType())),new p("totalHostExecutionDuration",c.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ut||(Ut={}));var De;(e=>{function t(){return c.createProductType([new p("tableId",c.createU32Type()),new p("tableName",c.createStringType()),new p("tableRows",Ne.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(De||(De={}));var Ft;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("totalHostExecutionDurationMicros",c.createU64Type()),new p("queryId",D.getTypeScriptAlgebraicType()),new p("rows",De.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ft||(Ft={}));var Ct;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("totalHostExecutionDurationMicros",c.createU64Type()),new p("queryId",D.getTypeScriptAlgebraicType()),new p("rows",De.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ct||(Ct={}));var Bt;(e=>{function t(){return c.createProductType([new p("totalHostExecutionDurationMicros",c.createU64Type()),new p("requestId",c.createOptionType(c.createU32Type())),new p("queryId",c.createOptionType(c.createU32Type())),new p("tableId",c.createOptionType(c.createU32Type())),new p("error",c.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Bt||(Bt={}));var kt;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("totalHostExecutionDurationMicros",c.createU64Type()),new p("queryId",D.getTypeScriptAlgebraicType()),new p("update",ee.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(kt||(kt={}));var Et;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("totalHostExecutionDurationMicros",c.createU64Type()),new p("queryId",D.getTypeScriptAlgebraicType()),new p("update",ee.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Et||(Et={}));var Pt;(e=>{e.InitialSubscription=i=>({tag:"InitialSubscription",value:i}),e.TransactionUpdate=i=>({tag:"TransactionUpdate",value:i}),e.TransactionUpdateLight=i=>({tag:"TransactionUpdateLight",value:i}),e.IdentityToken=i=>({tag:"IdentityToken",value:i}),e.OneOffQueryResponse=i=>({tag:"OneOffQueryResponse",value:i}),e.SubscribeApplied=i=>({tag:"SubscribeApplied",value:i}),e.UnsubscribeApplied=i=>({tag:"UnsubscribeApplied",value:i}),e.SubscriptionError=i=>({tag:"SubscriptionError",value:i}),e.SubscribeMultiApplied=i=>({tag:"SubscribeMultiApplied",value:i}),e.UnsubscribeMultiApplied=i=>({tag:"UnsubscribeMultiApplied",value:i});function t(){return c.createSumType([new _("InitialSubscription",mt.getTypeScriptAlgebraicType()),new _("TransactionUpdate",It.getTypeScriptAlgebraicType()),new _("TransactionUpdateLight",zt.getTypeScriptAlgebraicType()),new _("IdentityToken",_t.getTypeScriptAlgebraicType()),new _("OneOffQueryResponse",Ut.getTypeScriptAlgebraicType()),new _("SubscribeApplied",Ft.getTypeScriptAlgebraicType()),new _("UnsubscribeApplied",Ct.getTypeScriptAlgebraicType()),new _("SubscriptionError",Bt.getTypeScriptAlgebraicType()),new _("SubscribeMultiApplied",kt.getTypeScriptAlgebraicType()),new _("UnsubscribeMultiApplied",Et.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Pt||(Pt={}));var J,er,rt=(er=class{constructor(){T(this,J,new Map)}on(e,t){let r=s(this,J).get(e);r||(r=new Set,s(this,J).set(e,r)),r.add(t)}off(e,t){let r=s(this,J).get(e);r&&r.delete(t)}emit(e,...t){let r=s(this,J).get(e);if(r)for(let n of r)n(...t)}},J=new WeakMap,er),jr={component:"📦",info:"ℹ️",warn:"⚠️",error:"❌",debug:"🐛"},Zr={component:"color: #fff; background-color: #8D6FDD; padding: 2px 5px; border-radius: 3px;",info:"color: #fff; background-color: #007bff; padding: 2px 5px; border-radius: 3px;",warn:"color: #fff; background-color: #ffc107; padding: 2px 5px; border-radius: 3px;",error:"color: #fff; background-color: #dc3545; padding: 2px 5px; border-radius: 3px;",debug:"color: #fff; background-color: #28a745; padding: 2px 5px; border-radius: 3px;"},Xr={component:"color: #8D6FDD;",info:"color: #007bff;",warn:"color: #ffc107;",error:"color: #dc3545;",debug:"color: #28a745;"},G=(e,t)=>{console.log(`%c${jr[e]} ${e.toUpperCase()}%c ${t}`,Zr[e],Xr[e])},Jr=class{constructor(e){y(this,"rows");y(this,"tableTypeInfo");y(this,"emitter");y(this,"applyOperations",(e,t)=>{const r=[];if(this.tableTypeInfo.primaryKeyInfo!==void 0){const n=new Map,i=new Map;for(const a of e)if(a.type==="insert"){const[u,o]=n.get(a.rowId)||[a,0];n.set(a.rowId,[a,o+1])}else{const[u,o]=i.get(a.rowId)||[a,0];i.set(a.rowId,[a,o+1])}for(const[a,[u,o]]of n){const g=i.get(a);if(g){const[f,S]=g,w=o-S,A=this.update(t,a,u.row,w);A&&r.push(A),i.delete(a)}else{const f=this.insert(t,u,o);f&&r.push(f)}}for(const[a,u]of i.values()){const o=this.delete(t,a,u);o&&r.push(o)}}else for(const n of e)if(n.type==="insert"){const i=this.insert(t,n);i&&r.push(i)}else{const i=this.delete(t,n);i&&r.push(i)}return r});y(this,"update",(e,t,r,n=0)=>{const i=this.rows.get(t);if(!i){G("error",`Updating a row that was not present in the cache. Table: ${this.tableTypeInfo.tableName}, RowId: ${t}`);return}const[a,u]=i,o=Math.max(1,u+n);if(u+n<=0){G("error",`Negative reference count for in table ${this.tableTypeInfo.tableName} row ${t} (${u} + ${n})`);return}return this.rows.set(t,[r,o]),u===0?(G("error",`Updating a row id in table ${this.tableTypeInfo.tableName} which was not present in the cache (rowId: ${t})`),{type:"insert",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("insert",e,r)}}):{type:"update",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("update",e,a,r)}}});y(this,"insert",(e,t,r=1)=>{const[n,i]=this.rows.get(t.rowId)||[t.row,0];if(this.rows.set(t.rowId,[t.row,i+r]),i===0)return{type:"insert",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("insert",e,t.row)}}});y(this,"delete",(e,t,r=1)=>{const[n,i]=this.rows.get(t.rowId)||[t.row,0];if(i===0){G("warn","Deleting a row that was not present in the cache");return}if(i<=r)return this.rows.delete(t.rowId),{type:"delete",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("delete",e,t.row)}};this.rows.set(t.rowId,[t.row,i-r])});y(this,"onInsert",e=>{this.emitter.on("insert",e)});y(this,"onDelete",e=>{this.emitter.on("delete",e)});y(this,"onUpdate",e=>{this.emitter.on("update",e)});y(this,"removeOnInsert",e=>{this.emitter.off("insert",e)});y(this,"removeOnDelete",e=>{this.emitter.off("delete",e)});y(this,"removeOnUpdate",e=>{this.emitter.off("update",e)});this.tableTypeInfo=e,this.rows=new Map,this.emitter=new rt}count(){return this.rows.size}iter(){return Array.from(this.rows.values()).map(([e])=>e)}},Yr=class{constructor(){y(this,"tables");this.tables=new Map}getTable(e){const t=this.tables.get(e);if(!t)throw console.error("The table has not been registered for this client. Please register the table before using it. If you have registered global tables using the SpacetimeDBClient.registerTables() or `registerTable()` method, please make sure that is executed first!"),new Error(`Table ${e} does not exist`);return t}getOrCreateTable(e){let t;return this.tables.has(e.tableName)?t=this.tables.get(e.tableName):(t=new Jr(e),this.tables.set(e.tableName,t)),t}};function Qr(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;n++){const i=e[n],a=t[n];if(i!==a)return typeof i=="number"&&typeof a=="number"?i-a:typeof i=="string"&&typeof a=="string"?i.localeCompare(a):typeof i=="string"?1:-1}return e.length-t.length}var ur=class xt{constructor(t,r,n,i=null,a=null){y(this,"major");y(this,"minor");y(this,"patch");y(this,"preRelease");y(this,"buildInfo");this.major=t,this.minor=r,this.patch=n,this.preRelease=i,this.buildInfo=a}toString(){let t=`${this.major}.${this.minor}.${this.patch}`;return this.preRelease&&(t+=`-${this.preRelease.join(".")}`),this.buildInfo&&(t+=`+${this.buildInfo}`),t}compare(t){return this.major!==t.major?this.major-t.major:this.minor!==t.minor?this.minor-t.minor:this.patch!==t.patch?this.patch-t.patch:this.preRelease&&t.preRelease?Qr(this.preRelease,t.preRelease):this.preRelease||t.preRelease?-1:0}clone(){return new xt(this.major,this.minor,this.patch,this.preRelease?[...this.preRelease]:null,this.buildInfo)}static parseVersionString(t){const r=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-([\da-zA-Z-]+(?:\.[\da-zA-Z-]+)*))?(?:\+([\da-zA-Z-]+(?:\.[\da-zA-Z-]+)*))?$/,n=t.match(r);if(!n)throw new Error(`Invalid version string: ${t}`);const i=parseInt(n[1],10),a=parseInt(n[2],10),u=parseInt(n[3],10),o=n[4]?n[4].split(".").map(f=>isNaN(Number(f))?f:Number(f)):null,g=n[5]||null;return new xt(i,a,u,o,g)}},dr=new ur(1,2,0);function ei(e){if(e===void 0)throw new Error(Xt(e));if(ur.parseVersionString(e).compare(dr)<0)throw new Error(Xt(e))}function Xt(e){return`Module code was generated with an incompatible version of the spacetimedb cli (${e}).  Update the cli version to at least ${dr.toString()} and regenerate the bindings. You can upgrade to the latest cli version by running: spacetime version upgrade`}async function hr(e,t,r=128*1024){let n=0;const i=new ReadableStream({pull(B){if(n<e.length){const k=e.subarray(n,Math.min(n+r,e.length));B.enqueue(k),n+=r}else B.close()}}),a=new DecompressionStream(t),o=i.pipeThrough(a).getReader(),g=[];let f=0,S;for(;!(S=await o.read()).done;)g.push(S.value),f+=S.value.length;const w=new Uint8Array(f);let A=0;for(const B of g)w.set(B,A),A+=B.length;return w}var le,Ge,yr,je,gr,Se,Ot,Ae,ti=(Ae=class{constructor(t){T(this,Ge);T(this,je);T(this,Se);y(this,"onclose");y(this,"onopen");y(this,"onmessage");y(this,"onerror");T(this,le,void 0);this.onmessage=void 0,this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,t.onmessage=h(this,Ge,yr).bind(this),t.onerror=h(this,Se,Ot).bind(this),t.onclose=h(this,Se,Ot).bind(this),t.onopen=h(this,je,gr).bind(this),t.binaryType="arraybuffer",d(this,le,t)}send(t){s(this,le).send(t)}close(){s(this,le).close()}static async createWebSocketFn({url:t,nameOrAddress:r,wsProtocol:n,authToken:i,compression:a,lightMode:u}){const o=new Headers;let g;g=WebSocket;let f;if(i){o.set("Authorization",`Bearer ${i}`);const A=new URL("v1/identity/websocket-token",t);A.protocol=t.protocol==="wss:"?"https:":"http:";const B=await fetch(A,{method:"POST",headers:o});if(B.ok){const{token:k}=await B.json();f=k}else return Promise.reject(new Error(`Failed to verify token: ${B.statusText}`))}const S=new URL(`v1/database/${r}/subscribe`,t);f&&S.searchParams.set("token",f),S.searchParams.set("compression",a==="gzip"?"Gzip":"None"),u&&S.searchParams.set("light","true");const w=new g(S.toString(),n);return new Ae(w)}},le=new WeakMap,Ge=new WeakSet,yr=async function(t){const r=new Uint8Array(t.data);let n;if(r[0]===0)n=r.slice(1);else{if(r[0]===1)throw new Error("Brotli Compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");if(r[0]===2)n=await hr(r.slice(1),"gzip");else throw new Error("Unexpected Compression Algorithm. Please use `gzip` or `none`")}this.onmessage?.({data:n})},je=new WeakSet,gr=function(t){this.onopen?.(t)},Se=new WeakSet,Ot=function(t){this.onerror?.(t)},Ae),pe,ue,Ze,Ie,Y,ze,_e,de,tr,ri=(tr=class{constructor(e,t){T(this,pe,void 0);T(this,ue,void 0);T(this,Ze,void 0);T(this,Ie,void 0);T(this,Y,new rt);T(this,ze,"gzip");T(this,_e,!1);T(this,de,void 0);this.remoteModule=e,this.dbConnectionConstructor=t,d(this,de,ti.createWebSocketFn)}withUri(e){return d(this,pe,new URL(e)),this}withModuleName(e){return d(this,ue,e),this}withToken(e){return d(this,Ie,e),this}withWSFn(e){return d(this,de,e),this}withCompression(e){return d(this,ze,e),this}withLightMode(e){return d(this,_e,e),this}onConnect(e){return s(this,Y).on("connect",e),this}onConnectError(e){return s(this,Y).on("connectError",e),this}onDisconnect(e){return s(this,Y).on("disconnect",e),this}build(){if(!s(this,pe))throw new Error("URI is required to connect to SpacetimeDB");if(!s(this,ue))throw new Error("Database name or address is required to connect to SpacetimeDB");return ei(this.remoteModule.versionInfo?.cliVersion),this.dbConnectionConstructor(new fr({uri:s(this,pe),nameOrAddress:s(this,ue),identity:s(this,Ze),token:s(this,Ie),emitter:s(this,Y),compression:s(this,ze),lightMode:s(this,_e),createWSFn:s(this,de),remoteModule:this.remoteModule}))}},pe=new WeakMap,ue=new WeakMap,Ze=new WeakMap,Ie=new WeakMap,Y=new WeakMap,ze=new WeakMap,_e=new WeakMap,de=new WeakMap,tr),ve,Ue,rr,Tr=(rr=class{constructor(e){T(this,ve,void 0);T(this,Ue,void 0);this.db=e}onApplied(e){return d(this,ve,e),this}onError(e){return d(this,Ue,e),this}subscribe(e){const t=Array.isArray(e)?e:[e];if(t.length===0)throw new Error("Subscriptions must have at least one query");return new ni(this.db,t,s(this,ve),s(this,Ue))}subscribeToAllTables(){this.subscribe("SELECT * FROM *")}},ve=new WeakMap,Ue=new WeakMap,rr),ii=class{constructor(){y(this,"subscriptions",new Map)}},he,Q,V,W,K,ir,ni=(ir=class{constructor(e,t,r,n){T(this,he,void 0);T(this,Q,!1);T(this,V,!1);T(this,W,!1);T(this,K,new rt);this.db=e,s(this,K).on("applied",i=>{d(this,W,!0),r&&r(i)}),s(this,K).on("error",(i,a)=>{d(this,W,!1),d(this,V,!0),n&&n(i,a)}),d(this,he,this.db.registerSubscription(this,s(this,K),t))}unsubscribe(){if(s(this,Q))throw new Error("Unsubscribe has already been called");d(this,Q,!0),this.db.unregisterSubscription(s(this,he)),s(this,K).on("end",e=>{d(this,V,!0),d(this,W,!1)})}unsubscribeThen(e){if(s(this,V))throw new Error("Subscription has already ended");if(s(this,Q))throw new Error("Unsubscribe has already been called");d(this,Q,!0),this.db.unregisterSubscription(s(this,he)),s(this,K).on("end",t=>{d(this,V,!0),d(this,W,!1),e(t)})}isEnded(){return s(this,V)}isActive(){return s(this,W)}},he=new WeakMap,Q=new WeakMap,V=new WeakMap,W=new WeakMap,K=new WeakMap,ir);function si(e){switch(e){case"FullUpdate":return 0;case"NoSuccessNotify":return 1}}var Fe,x,ye,Xe,P,Ce,M,Je,Ye,br,ge,Oe,Qe,mr,q,X,et,wr,tt,Sr,qt,ai,Lt,ci,$t,oi,Ht,li,Vt,pi,Wt,ui,Kt,di,Gt,hi,nr,fr=(nr=class{constructor({uri:e,nameOrAddress:t,identity:r,token:n,emitter:i,remoteModule:a,createWSFn:u,compression:o,lightMode:g}){T(this,Ye);T(this,ge);T(this,Qe);T(this,q);T(this,et);T(this,tt);T(this,qt);T(this,Lt);T(this,$t);T(this,Ht);T(this,Vt);T(this,Wt);T(this,Kt);T(this,Gt);y(this,"isActive",!1);y(this,"identity");y(this,"token");y(this,"db");y(this,"reducers");y(this,"setReducerFlags");y(this,"connectionId",st.random());T(this,Fe,0);T(this,x,void 0);T(this,ye,new rt);T(this,Xe,void 0);T(this,P,void 0);T(this,Ce,Promise.resolve());T(this,M,new ii);y(this,"clientCache");y(this,"ws");y(this,"wsPromise");T(this,Je,()=>{const e=s(this,Fe);return d(this,Fe,s(this,Fe)+1),e});y(this,"subscriptionBuilder",()=>new Tr(this));G("info","Connecting to SpacetimeDB WS...");let f=new URL(e);/^wss?:/.test(e.protocol)||(f.protocol=f.protocol==="https:"?"wss:":"ws:"),this.identity=r,this.token=n,d(this,P,a),d(this,x,i);let S=this.connectionId.toHexString();f.searchParams.set("connection_id",S),this.clientCache=new Yr,this.db=s(this,P).dbViewConstructor(this),this.setReducerFlags=s(this,P).setReducerFlagsConstructor(),this.reducers=s(this,P).reducersConstructor(this,this.setReducerFlags),this.wsPromise=u({url:f,nameOrAddress:t,wsProtocol:"v1.bsatn.spacetimedb",authToken:n,compression:o,lightMode:g}).then(w=>(this.ws=w,this.ws.onclose=()=>{s(this,x).emit("disconnect",this)},this.ws.onerror=A=>{s(this,x).emit("connectError",this,A)},this.ws.onopen=h(this,Qe,mr).bind(this),this.ws.onmessage=h(this,tt,Sr).bind(this),w)).catch(w=>{G("error","Error connecting to SpacetimeDB WS"),s(this,x).emit("connectError",this,w)})}registerSubscription(e,t,r){const n=s(this,Je).call(this);return s(this,M).subscriptions.set(n,{handle:e,emitter:t}),h(this,ge,Oe).call(this,ie.SubscribeMulti({queryStrings:r,queryId:{id:n},requestId:0})),n}unregisterSubscription(e){h(this,ge,Oe).call(this,ie.UnsubscribeMulti({queryId:{id:e},requestId:0}))}callReducer(e,t,r){const n=ie.CallReducer({reducer:e,args:t,requestId:0,flags:si(r)});h(this,ge,Oe).call(this,n)}disconnect(){this.wsPromise.then(e=>{e&&e.close()})}onReducer(e,t){s(this,ye).on(e,t)}offReducer(e,t){s(this,ye).off(e,t)}},Fe=new WeakMap,x=new WeakMap,ye=new WeakMap,Xe=new WeakMap,P=new WeakMap,Ce=new WeakMap,M=new WeakMap,Je=new WeakMap,Ye=new WeakSet,br=async function(e){const t=(i,a,u)=>{const o=u.rowsData,g=new ce(o),f=[],S=s(this,P).tables[a].rowType,w=s(this,P).tables[a].primaryKeyInfo;for(;g.offset<o.length+o.byteOffset;){const A=g.offset,B=S.deserialize(g);let k;if(w!==void 0)k=w.colType.intoMapKey(B[w.colName]);else{const te=o.subarray(A-o.byteOffset,g.offset-o.byteOffset);k=sr(te)}f.push({type:i,rowId:k,row:B})}return f},r=async i=>{const a=i.tableName;let u=[];for(const o of i.updates){let g;if(o.tag==="Gzip"){const f=await hr(o.value,"gzip");g=Me.deserialize(new ce(f))}else{if(o.tag==="Brotli")throw new Error("Brotli compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");g=o.value}u=u.concat(t("insert",a,g.inserts)),u=u.concat(t("delete",a,g.deletes))}return{tableName:a,operations:u}},n=async i=>{const a=[];for(const u of i.tables)a.push(await r(u));return a};switch(e.tag){case"InitialSubscription":{const i=e.value.databaseUpdate;return{tag:"InitialSubscription",tableUpdates:await n(i)}}case"TransactionUpdateLight":{const i=e.value.update;return{tag:"TransactionUpdateLight",tableUpdates:await n(i)}}case"TransactionUpdate":{const i=e.value,a=i.callerIdentity,u=st.nullIfZero(i.callerConnectionId),o=i.reducerCall.reducerName,g=i.reducerCall.args,f=i.energyQuantaUsed;let S,w="";switch(i.status.tag){case"Committed":S=await n(i.status.value);break;case"Failed":S=[],w=i.status.value;break;case"OutOfEnergy":S=[];break}if(o==="<none>"){console.error(`Received an error from the database: ${w}`);return}let A;return o!==""&&(A={reducerName:o,args:g}),{tag:"TransactionUpdate",tableUpdates:S,identity:a,connectionId:u,reducerInfo:A,status:i.status,energyConsumed:f.quanta,message:w,timestamp:i.timestamp}}case"IdentityToken":return{tag:"IdentityToken",identity:e.value.identity,token:e.value.token,connectionId:e.value.connectionId};case"OneOffQueryResponse":throw new Error(`TypeScript SDK never sends one-off queries, but got OneOffQueryResponse ${e}`);case"SubscribeMultiApplied":{const i=await n(e.value.update);return{tag:"SubscribeApplied",queryId:e.value.queryId.id,tableUpdates:i}}case"UnsubscribeMultiApplied":{const i=await n(e.value.update);return{tag:"UnsubscribeApplied",queryId:e.value.queryId.id,tableUpdates:i}}case"SubscriptionError":return{tag:"SubscriptionError",queryId:e.value.queryId,error:e.value.error}}},ge=new WeakSet,Oe=function(e){this.wsPromise.then(t=>{if(t){const r=new j(1024);ie.serialize(r,e);const n=r.getBuffer();t.send(n)}})},Qe=new WeakSet,mr=function(){this.isActive=!0},q=new WeakSet,X=function(e,t){let r=[];for(let n of e){const i=n.tableName,a=s(this,P).tables[i],o=this.clientCache.getOrCreateTable(a).applyOperations(n.operations,t);for(const g of o)r.push(g)}return r},et=new WeakSet,wr=async function(e){var n;const t=Gr(Pt,e),r=await h(this,Ye,br).call(this,t);if(r)switch(r.tag){case"InitialSubscription":{let i={tag:"SubscribeApplied"};const a=s(this,P).eventContextConstructor(this,i),{event:u,...o}=a,g=h(this,q,X).call(this,r.tableUpdates,a);s(this,x)&&((n=s(this,Xe))==null||n.call(this,o));for(const f of g)f.cb();break}case"TransactionUpdateLight":{let i={tag:"UnknownTransaction"};const a=s(this,P).eventContextConstructor(this,i),u=h(this,q,X).call(this,r.tableUpdates,a);for(const o of u)o.cb();break}case"TransactionUpdate":{let i=r.reducerInfo,a=!1,u,o;if(!i)a=!0;else{o=s(this,P).reducers[i.reducerName];try{const k=new ce(i.args);u=o.argsType.deserialize(k)}catch{console.debug("Failed to deserialize reducer arguments"),a=!0}}if(a){const k={tag:"UnknownTransaction"},te=s(this,P).eventContextConstructor(this,k),Be=h(this,q,X).call(this,r.tableUpdates,te);for(const it of Be)it.cb();return}i=i,o=o;const g={callerIdentity:r.identity,status:r.status,callerConnectionId:r.connectionId,timestamp:r.timestamp,energyConsumed:r.energyConsumed,reducer:{name:i.reducerName,args:u}},f={tag:"Reducer",value:g},S=s(this,P).eventContextConstructor(this,f),w={...S,event:g},A=h(this,q,X).call(this,r.tableUpdates,S),B=[];o.argsType.product.elements.forEach((k,te)=>{B.push(u[k.name])}),s(this,ye).emit(i.reducerName,w,...B);for(const k of A)k.cb();break}case"IdentityToken":{this.identity=r.identity,!this.token&&r.token&&(this.token=r.token),this.connectionId=r.connectionId,s(this,x).emit("connect",this,this.identity,this.token);break}case"SubscribeApplied":{const i=s(this,M).subscriptions.get(r.queryId);if(i===void 0){G("error",`Received SubscribeApplied for unknown queryId ${r.queryId}.`);break}const a={tag:"SubscribeApplied"},u=s(this,P).eventContextConstructor(this,a),{event:o,...g}=u,f=h(this,q,X).call(this,r.tableUpdates,u);i?.emitter.emit("applied",g);for(const S of f)S.cb();break}case"UnsubscribeApplied":{const i=s(this,M).subscriptions.get(r.queryId);if(i===void 0){G("error",`Received UnsubscribeApplied for unknown queryId ${r.queryId}.`);break}const a={tag:"UnsubscribeApplied"},u=s(this,P).eventContextConstructor(this,a),{event:o,...g}=u,f=h(this,q,X).call(this,r.tableUpdates,u);i?.emitter.emit("end",g),s(this,M).subscriptions.delete(r.queryId);for(const S of f)S.cb();break}case"SubscriptionError":{const i=Error(r.error),a={tag:"Error",value:i},o={...s(this,P).eventContextConstructor(this,a),event:i};r.queryId!==void 0?(s(this,M).subscriptions.get(r.queryId)?.emitter.emit("error",o,i),s(this,M).subscriptions.delete(r.queryId)):(console.error("Received an error message without a queryId: ",i),s(this,M).subscriptions.forEach(({emitter:g})=>{g.emit("error",o,i)}))}}},tt=new WeakSet,Sr=function(e){d(this,Ce,s(this,Ce).then(()=>h(this,et,wr).call(this,e.data)))},qt=new WeakSet,ai=function(e,t){s(this,x).on(e,t)},Lt=new WeakSet,ci=function(e,t){s(this,x).off(e,t)},$t=new WeakSet,oi=function(e){s(this,x).on("connect",e)},Ht=new WeakSet,li=function(e){s(this,x).on("disconnect",e)},Vt=new WeakSet,pi=function(e){s(this,x).on("connectError",e)},Wt=new WeakSet,ui=function(e){s(this,x).off("connect",e)},Kt=new WeakSet,di=function(e){s(this,x).off("disconnect",e)},Gt=new WeakSet,hi=function(e){s(this,x).off("connectError",e)},nr),qe;(e=>{function t(){return c.createProductType([new p("name",c.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(qe||(qe={}));var Le;(e=>{function t(){return c.createProductType([new p("id",c.createU256Type())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Le||(Le={}));var $e;(e=>{function t(){return c.createProductType([new p("id",c.createU256Type())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})($e||($e={}));var Rt;(e=>{function t(){return c.createProductType([])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Rt||(Rt={}));var Mt;(e=>{function t(){return c.createProductType([])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Mt||(Mt={}));var Nt;(e=>{function t(){return c.createProductType([])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Nt||(Nt={}));var yi=Object.defineProperty,gi=(e,t,r)=>t in e?yi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,L=(e,t,r)=>(gi(e,typeof t!="symbol"?t+"":t,r),r);class Ti{constructor(t){L(this,"tableCache"),L(this,"id",{find:r=>{for(let n of this.tableCache.iter())if(jt(n.id,r))return n}}),L(this,"onInsert",r=>this.tableCache.onInsert(r)),L(this,"removeOnInsert",r=>this.tableCache.removeOnInsert(r)),L(this,"onDelete",r=>this.tableCache.onDelete(r)),L(this,"removeOnDelete",r=>this.tableCache.removeOnDelete(r)),L(this,"onUpdate",r=>this.tableCache.onUpdate(r)),L(this,"removeOnUpdate",r=>this.tableCache.removeOnUpdate(r)),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}var fi=Object.defineProperty,bi=(e,t,r)=>t in e?fi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,$=(e,t,r)=>(bi(e,typeof t!="symbol"?t+"":t,r),r);class mi{constructor(t){$(this,"tableCache"),$(this,"id",{find:r=>{for(let n of this.tableCache.iter())if(jt(n.id,r))return n}}),$(this,"onInsert",r=>this.tableCache.onInsert(r)),$(this,"removeOnInsert",r=>this.tableCache.removeOnInsert(r)),$(this,"onDelete",r=>this.tableCache.onDelete(r)),$(this,"removeOnDelete",r=>this.tableCache.removeOnDelete(r)),$(this,"onUpdate",r=>this.tableCache.onUpdate(r)),$(this,"removeOnUpdate",r=>this.tableCache.removeOnUpdate(r)),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}var wi=Object.defineProperty,Si=(e,t,r)=>t in e?wi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Te=(e,t,r)=>(Si(e,typeof t!="symbol"?t+"":t,r),r);class Ai{constructor(t){Te(this,"tableCache"),Te(this,"onInsert",r=>this.tableCache.onInsert(r)),Te(this,"removeOnInsert",r=>this.tableCache.removeOnInsert(r)),Te(this,"onDelete",r=>this.tableCache.onDelete(r)),Te(this,"removeOnDelete",r=>this.tableCache.removeOnDelete(r)),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}var He;(e=>{function t(){return c.createProductType([new p("id",c.createU256Type()),new p("check",c.createU256Type())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(He||(He={}));var Ve;(e=>{function t(){return c.createProductType([new p("id",c.createU256Type())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ve||(Ve={}));var We;(e=>{function t(){return c.createProductType([new p("id",c.createU256Type()),new p("left",c.createOptionType(He.getTypeScriptAlgebraicType())),new p("right",c.createOptionType(He.getTypeScriptAlgebraicType()))])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(We||(We={}));var Dt;(e=>{function t(){return c.createProductType([new p("name",c.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,a){e.getTypeScriptAlgebraicType().serialize(i,a)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Dt||(Dt={}));var Ii=Object.defineProperty,zi=(e,t,r)=>t in e?Ii(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ne=(e,t,r)=>(zi(e,typeof t!="symbol"?t+"":t,r),r);const Re={tables:{item:{tableName:"item",rowType:Ve.getTypeScriptAlgebraicType(),primaryKey:"id",primaryKeyInfo:{colName:"id",colType:Ve.getTypeScriptAlgebraicType().product.elements[0].algebraicType}},merkle_tree:{tableName:"merkle_tree",rowType:We.getTypeScriptAlgebraicType(),primaryKey:"id",primaryKeyInfo:{colName:"id",colType:We.getTypeScriptAlgebraicType().product.elements[0].algebraicType}},person:{tableName:"person",rowType:Dt.getTypeScriptAlgebraicType()}},reducers:{add:{reducerName:"add",argsType:qe.getTypeScriptAlgebraicType()},add_item:{reducerName:"add_item",argsType:Le.getTypeScriptAlgebraicType()},add_tree:{reducerName:"add_tree",argsType:$e.getTypeScriptAlgebraicType()},identity_connected:{reducerName:"identity_connected",argsType:Rt.getTypeScriptAlgebraicType()},identity_disconnected:{reducerName:"identity_disconnected",argsType:Mt.getTypeScriptAlgebraicType()},say_hello:{reducerName:"say_hello",argsType:Nt.getTypeScriptAlgebraicType()}},versionInfo:{cliVersion:"1.2.0"},eventContextConstructor:(e,t)=>({...e,event:t}),dbViewConstructor:e=>new Ui(e),reducersConstructor:(e,t)=>new _i(e,t),setReducerFlagsConstructor:()=>new vi};class _i{constructor(t,r){this.connection=t,this.setCallReducerFlags=r}add(t){const r={name:t};let n=new j(1024);qe.getTypeScriptAlgebraicType().serialize(n,r);let i=n.getBuffer();this.connection.callReducer("add",i,this.setCallReducerFlags.addFlags)}onAdd(t){this.connection.onReducer("add",t)}removeOnAdd(t){this.connection.offReducer("add",t)}addItem(t){const r={id:t};let n=new j(1024);Le.getTypeScriptAlgebraicType().serialize(n,r);let i=n.getBuffer();this.connection.callReducer("add_item",i,this.setCallReducerFlags.addItemFlags)}onAddItem(t){this.connection.onReducer("add_item",t)}removeOnAddItem(t){this.connection.offReducer("add_item",t)}addTree(t){const r={id:t};let n=new j(1024);$e.getTypeScriptAlgebraicType().serialize(n,r);let i=n.getBuffer();this.connection.callReducer("add_tree",i,this.setCallReducerFlags.addTreeFlags)}onAddTree(t){this.connection.onReducer("add_tree",t)}removeOnAddTree(t){this.connection.offReducer("add_tree",t)}onIdentityConnected(t){this.connection.onReducer("identity_connected",t)}removeOnIdentityConnected(t){this.connection.offReducer("identity_connected",t)}onIdentityDisconnected(t){this.connection.onReducer("identity_disconnected",t)}removeOnIdentityDisconnected(t){this.connection.offReducer("identity_disconnected",t)}sayHello(){this.connection.callReducer("say_hello",new Uint8Array(0),this.setCallReducerFlags.sayHelloFlags)}onSayHello(t){this.connection.onReducer("say_hello",t)}removeOnSayHello(t){this.connection.offReducer("say_hello",t)}}class vi{constructor(){ne(this,"addFlags","FullUpdate"),ne(this,"addItemFlags","FullUpdate"),ne(this,"addTreeFlags","FullUpdate"),ne(this,"sayHelloFlags","FullUpdate")}add(t){this.addFlags=t}addItem(t){this.addItemFlags=t}addTree(t){this.addTreeFlags=t}sayHello(t){this.sayHelloFlags=t}}class Ui{constructor(t){this.connection=t}get item(){return new Ti(this.connection.clientCache.getOrCreateTable(Re.tables.item))}get merkleTree(){return new mi(this.connection.clientCache.getOrCreateTable(Re.tables.merkle_tree))}get person(){return new Ai(this.connection.clientCache.getOrCreateTable(Re.tables.person))}}class Fi extends Tr{}class Ar extends fr{constructor(){super(...arguments),ne(this,"subscriptionBuilder",()=>new Fi(this))}}ne(Ar,"builder",()=>new ri(Re,e=>e));var Ci=Object.defineProperty,Bi=(e,t,r)=>t in e?Ci(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Jt=(e,t,r)=>(Bi(e,typeof t!="symbol"?t+"":t,r),r);class ki{constructor(t){Jt(this,"value"),Jt(this,"listeners",[]),this.value=t}get(){return this.value}set(t,r=!1){if(!(!r&&t===this.value)){for(const n of this.listeners)n(t);this.value=t}}update(t,r=!1){const n=t(this.value);this.set(n,r)}subscribe(t){this.listeners.push(t),t(this.value)}subscribeLater(t){this.listeners.push(t)}}const Ei="merklestore",Pi=window.location.pathname.split("/").includes("local")?"local":"remote",xi=Pi=="local"?"ws://localhost:3000":"wss://maincloud.spacetimedb.com",se=new ki(0n);async function ae(e){const t=[];if(e.type==="node"){if(e.left){const o=e.left.proof.type==="pair"?e.left.check:await ae(e.left.proof);if(e.left.proof.type==="node"&&o!=e.left.check)throw new Error("Left check does not match");t.push(Pe(o))}if(e.right){const o=e.right.proof.type==="pair"?e.right.check:await ae(e.right.proof);if(e.right.proof.type==="node"&&o!=e.right.check)throw new Error("Right check does not match");t.push(Pe(o))}t.push(Pe(e.id))}else t.push(Pe(e.check));const r=t.reduce((o,g)=>o+g.length,0),n=new Uint8Array(r);let i=0;for(const o of t)n.set(o,i),i+=o.length;const a=await crypto.subtle.digest("SHA-256",n),u=new Uint8Array(a);return BigInt("0x"+Array.from(u).map(o=>o.toString(16).padStart(2,"0")).join(""))}function Pe(e){const t=e.toString(16).padStart(64,"0"),r=new Uint8Array(32);for(let n=0;n<32;n++)r[n]=parseInt(t.slice(n*2,n*2+2),16);return r}function Ke(e,t){return!!(e.type==="node"&&(e.id==t||e.left&&Ke(e.left.proof,t)||e.right&&Ke(e.right.proof,t)))}const Oi=()=>new Promise((e,t)=>{Ar.builder().withUri(xi).withModuleName(Ei).onConnect(r=>{r.subscriptionBuilder().onApplied(u=>{console.log(u.db.merkleTree.id.find(0n)),u.db.merkleTree.onInsert((o,g)=>{i(0n,0n).then(f=>ae(f).then(S=>se.set(S)))})}).onError(u=>console.error(u.event?.message)).subscribe("SELECT * FROM merkle_tree WHERE id = 0");const n=u=>new Promise((o,g)=>{r.subscriptionBuilder().onApplied(f=>{let S=f.db.item.id.find(u)!=null;S&&i(0n,u).then(w=>{ae(w).then(A=>{se.get()!=A?alert("Global check does not match"):console.log("Global check matches"),Ke(w,u)||alert("Proof does not contain node")})}).catch(console.error),o(S)}).onError(f=>{console.error(f.event?.message),g(f.event?.message)}).subscribe(`SELECT * FROM item WHERE id = ${u}`)}),i=(u,o)=>new Promise((g,f)=>{r.subscriptionBuilder().onApplied(async S=>{let w=S.db.merkleTree.id.find(u);if(w==null)return f("Tree not found");let A={type:"node",id:w.id,left:w.left==null?void 0:{check:w.left.check,proof:{type:"pair",...w.left}},right:w.right==null?void 0:{check:w.right.check,proof:{type:"pair",...w.right}}};if(w.id>o){if(w.left==null)return f("Left child not found");A.left.proof=await i(w.left.id,o)}if(w.id<o){if(w.right==null)return f("Right child not found");A.right.proof=await i(w.right.id,o)}g(A)}).subscribe(`SELECT * FROM merkle_tree WHERE id = ${u}`)});i(0n,0n).then(u=>ae(u).then(o=>se.set(o))),e({checkHash:n,storeHash:u=>new Promise((o,g)=>{r.reducers.onAddItem((f,S)=>{console.log(f.event.status),o()}),r.reducers.addItem(u),r.reducers.onAddTree((f,S)=>{console.log("Tree added",S),i(0n,S).then(w=>{ae(w).then(A=>{se.get()!=A?alert("Global check does not match"):console.log("Global check matches"),Ke(w,S)||alert("Proof does not contain node")})}).catch(console.error)}),r.reducers.addTree(u)})})}).onConnectError(r=>t(r)).build()}),U=(e,t,r,n)=>{const i=document.createElement(e);return i.innerText=t,r&&i.classList.add(...r.split(".").filter(a=>a)),n&&Object.entries(n).forEach(([a,u])=>{a==="children"?u.forEach(o=>i.appendChild(o)):a==="eventListeners"?Object.entries(u).forEach(([o,g])=>{i.addEventListener(o,g)}):a==="color"||a==="background"?i.style[a]=u:a==="attributes"?Object.entries(u).forEach(([o,g])=>{i.setAttribute(o,g)}):i[a]=u}),i};async function Ri(e){const t=await e.arrayBuffer(),r=await crypto.subtle.digest("SHA-256",t),n=Array.from(new Uint8Array(r));return BigInt("0x"+n.map(i=>i.toString(16).padStart(2,"0")).join(""))}Oi().then(e=>{const t=U("div","","check-info");function r(){const n=U("div","","upload-container",{children:[U("h2","Document Hasher","upload-title"),t,U("p","Select files to hash:","upload-description"),U("input","","file-input",{attributes:{type:"file",multiple:"true"}})]}),i=n.querySelector(".file-input"),a=U("div","","check-info"),u=U("div","","status-container"),o=U("div","","file-info");return se.subscribe(g=>{t.innerHTML="Global Check: "+g.toString()}),se.subscribeLater(g=>{a.insertBefore(U("div","Global Check updated","check-info"),a.firstChild)}),i.addEventListener("change",async g=>{const f=g.target.files;if(!(!f||f.length===0)){u.innerHTML="";for(let S=0;S<f.length;S++){const w=f[S];try{const A=await Ri(w);o.innerHTML="";const B=U("div",w.name,"file-name"),k=U("div",`(${(w.size/1024).toFixed(2)} KB)`,"file-size"),te=U("div","","file-header",{children:[B,k]}),Be=U("span","SHA-256: ","hash-label"),it=U("span",A.toString(),"hash-value"),Ir=U("div","","hash-container",{children:[Be,it]});o.appendChild(te),o.appendChild(Ir),o.appendChild(a);const zr=U("button","Check","action-button.check-button",{eventListeners:{click:async()=>{const ke=await e.checkHash(A),Ur=U("div",ke?"✓ Exists":"✗ Does not exist",`status-message.${ke?"exists":"not-exists"}`);a.insertBefore(Ur,a.firstChild)}}}),_r=U("button","Store","action-button.store-button",{eventListeners:{click:async()=>{await e.storeHash(A).then(()=>{const ke=U("div","✓ Stored","status-message.stored");a.insertBefore(ke,a.firstChild)})}}}),vr=U("div","","button-group",{children:[zr,_r]});o.appendChild(vr)}catch(A){const B=A instanceof Error?A.message:"Unknown error occurred";o.innerHTML="";const k=U("div",`Error: ${B}`,"error-message");o.appendChild(k)}u.appendChild(o)}}}),n.appendChild(u),n}document.body.appendChild(r())});
