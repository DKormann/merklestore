var Sr=Object.defineProperty;var Ar=(e,t,i)=>t in e?Sr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var h=(e,t,i)=>(Ar(e,typeof t!="symbol"?t+"":t,i),i),Qe=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)};var n=(e,t,i)=>(Qe(e,t,"read from private field"),i?i.call(e):t.get(e)),g=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},d=(e,t,i,s)=>(Qe(e,t,"write to private field"),s?s.call(e,i):t.set(e,i),i);var y=(e,t,i)=>(Qe(e,t,"access private method"),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();var Qt=Ur,N=[],Vt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Ee=0,Ir=Vt.length;Ee<Ir;++Ee)N[Ee]=Vt[Ee];function zr(e){return N[e>>18&63]+N[e>>12&63]+N[e>>6&63]+N[e&63]}function _r(e,t,i){for(var s,r=[],a=t;a<i;a+=3)s=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(e[a+2]&255),r.push(zr(s));return r.join("")}function Ur(e){for(var t,i=e.length,s=i%3,r=[],a=16383,l=0,u=i-s;l<u;l+=a)r.push(_r(e,l,l+a>u?u:l+a));return s===1?(t=e[i-1],r.push(N[t>>2]+N[t<<4&63]+"==")):s===2&&(t=(e[i-2]<<8)+e[i-1],r.push(N[t>>10]+N[t>>4&63]+N[t<<2&63]+"=")),r.join("")}var S,f,Kt,ae=(Kt=class{constructor(e){g(this,S,void 0);g(this,f,0);d(this,S,new DataView(e.buffer)),d(this,f,e.byteOffset)}get offset(){return n(this,f)}readUInt8Array(){const e=this.readU32(),t=new Uint8Array(n(this,S).buffer,n(this,f),e);return d(this,f,n(this,f)+e),t}readBool(){const e=n(this,S).getUint8(n(this,f));return d(this,f,n(this,f)+1),e!==0}readByte(){const e=n(this,S).getUint8(n(this,f));return d(this,f,n(this,f)+1),e}readBytes(e){const t=new DataView(n(this,S).buffer,n(this,f),e);return d(this,f,n(this,f)+e),new Uint8Array(t.buffer)}readI8(){const e=n(this,S).getInt8(n(this,f));return d(this,f,n(this,f)+1),e}readU8(){const e=n(this,S).getUint8(n(this,f));return d(this,f,n(this,f)+1),e}readI16(){const e=n(this,S).getInt16(n(this,f),!0);return d(this,f,n(this,f)+2),e}readU16(){const e=n(this,S).getUint16(n(this,f),!0);return d(this,f,n(this,f)+2),e}readI32(){const e=n(this,S).getInt32(n(this,f),!0);return d(this,f,n(this,f)+4),e}readU32(){const e=n(this,S).getUint32(n(this,f),!0);return d(this,f,n(this,f)+4),e}readI64(){const e=n(this,S).getBigInt64(n(this,f),!0);return d(this,f,n(this,f)+8),e}readU64(){const e=n(this,S).getBigUint64(n(this,f),!0);return d(this,f,n(this,f)+8),e}readU128(){const e=n(this,S).getBigUint64(n(this,f),!0),t=n(this,S).getBigUint64(n(this,f)+8,!0);return d(this,f,n(this,f)+16),(t<<BigInt(64))+e}readI128(){const e=n(this,S).getBigUint64(n(this,f),!0),t=n(this,S).getBigInt64(n(this,f)+8,!0);return d(this,f,n(this,f)+16),(t<<BigInt(64))+e}readU256(){const e=n(this,S).getBigUint64(n(this,f),!0),t=n(this,S).getBigUint64(n(this,f)+8,!0),i=n(this,S).getBigUint64(n(this,f)+16,!0),s=n(this,S).getBigUint64(n(this,f)+24,!0);return d(this,f,n(this,f)+32),(s<<BigInt(3*64))+(i<<BigInt(2*64))+(t<<BigInt(1*64))+e}readI256(){const e=n(this,S).getBigUint64(n(this,f),!0),t=n(this,S).getBigUint64(n(this,f)+8,!0),i=n(this,S).getBigUint64(n(this,f)+16,!0),s=n(this,S).getBigInt64(n(this,f)+24,!0);return d(this,f,n(this,f)+32),(s<<BigInt(3*64))+(i<<BigInt(2*64))+(t<<BigInt(1*64))+e}readF32(){const e=n(this,S).getFloat32(n(this,f),!0);return d(this,f,n(this,f)+4),e}readF64(){const e=n(this,S).getFloat64(n(this,f),!0);return d(this,f,n(this,f)+8),e}readString(){const e=this.readU32(),t=new Uint8Array(n(this,S).buffer,n(this,f),e),s=new TextDecoder("utf-8").decode(t);return d(this,f,n(this,f)+e),s}},S=new WeakMap,f=new WeakMap,Kt),k,A,m,F,B,jt,Z=(jt=class{constructor(e){g(this,F);g(this,k,void 0);g(this,A,void 0);g(this,m,0);d(this,k,new Uint8Array(e)),d(this,A,new DataView(n(this,k).buffer))}toBase64(){return Qt(n(this,k).subarray(0,n(this,m)))}getBuffer(){return n(this,k).slice(0,n(this,m))}writeUInt8Array(e){const t=e.length;y(this,F,B).call(this,4+t),this.writeU32(t),n(this,k).set(e,n(this,m)),d(this,m,n(this,m)+e.length)}writeBool(e){y(this,F,B).call(this,1),n(this,A).setUint8(n(this,m),e?1:0),d(this,m,n(this,m)+1)}writeByte(e){y(this,F,B).call(this,1),n(this,A).setUint8(n(this,m),e),d(this,m,n(this,m)+1)}writeI8(e){y(this,F,B).call(this,1),n(this,A).setInt8(n(this,m),e),d(this,m,n(this,m)+1)}writeU8(e){y(this,F,B).call(this,1),n(this,A).setUint8(n(this,m),e),d(this,m,n(this,m)+1)}writeI16(e){y(this,F,B).call(this,2),n(this,A).setInt16(n(this,m),e,!0),d(this,m,n(this,m)+2)}writeU16(e){y(this,F,B).call(this,2),n(this,A).setUint16(n(this,m),e,!0),d(this,m,n(this,m)+2)}writeI32(e){y(this,F,B).call(this,4),n(this,A).setInt32(n(this,m),e,!0),d(this,m,n(this,m)+4)}writeU32(e){y(this,F,B).call(this,4),n(this,A).setUint32(n(this,m),e,!0),d(this,m,n(this,m)+4)}writeI64(e){y(this,F,B).call(this,8),n(this,A).setBigInt64(n(this,m),e,!0),d(this,m,n(this,m)+8)}writeU64(e){y(this,F,B).call(this,8),n(this,A).setBigUint64(n(this,m),e,!0),d(this,m,n(this,m)+8)}writeU128(e){y(this,F,B).call(this,16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),i=e>>BigInt(64);n(this,A).setBigUint64(n(this,m),t,!0),n(this,A).setBigUint64(n(this,m)+8,i,!0),d(this,m,n(this,m)+16)}writeI128(e){y(this,F,B).call(this,16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),i=e>>BigInt(64);n(this,A).setBigInt64(n(this,m),t,!0),n(this,A).setBigInt64(n(this,m)+8,i,!0),d(this,m,n(this,m)+16)}writeU256(e){y(this,F,B).call(this,32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),i=e&t,s=e>>BigInt(64*1)&t,r=e>>BigInt(64*2)&t,a=e>>BigInt(64*3);n(this,A).setBigUint64(n(this,m)+8*0,i,!0),n(this,A).setBigUint64(n(this,m)+8*1,s,!0),n(this,A).setBigUint64(n(this,m)+8*2,r,!0),n(this,A).setBigUint64(n(this,m)+8*3,a,!0),d(this,m,n(this,m)+32)}writeI256(e){y(this,F,B).call(this,32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),i=e&t,s=e>>BigInt(64*1)&t,r=e>>BigInt(64*2)&t,a=e>>BigInt(64*3);n(this,A).setBigUint64(n(this,m)+8*0,i,!0),n(this,A).setBigUint64(n(this,m)+8*1,s,!0),n(this,A).setBigUint64(n(this,m)+8*2,r,!0),n(this,A).setBigInt64(n(this,m)+8*3,a,!0),d(this,m,n(this,m)+32)}writeF32(e){y(this,F,B).call(this,4),n(this,A).setFloat32(n(this,m),e,!0),d(this,m,n(this,m)+4)}writeF64(e){y(this,F,B).call(this,8),n(this,A).setFloat64(n(this,m),e,!0),d(this,m,n(this,m)+8)}writeString(e){const i=new TextEncoder().encode(e);this.writeU32(i.length),y(this,F,B).call(this,i.length),n(this,k).set(i,n(this,m)),d(this,m,n(this,m)+i.length)}},k=new WeakMap,A=new WeakMap,m=new WeakMap,F=new WeakSet,B=function(e){const t=n(this,m)+e+1;if(t<=n(this,k).length)return;let i=n(this,k).length*2;i<t&&(i=t);const s=new Uint8Array(i);s.set(n(this,k)),d(this,k,s),d(this,A,new DataView(n(this,k).buffer))},jt);function Ht(e,t){if(e===t)return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;for(let r of i)if(!s.includes(r)||!Ht(e[r],t[r]))return!1;return!0}function er(e){return Array.prototype.map.call(e.reverse(),t=>("00"+t.toString(16)).slice(-2)).join("")}function vr(e){if(e.length!=16)throw new Error(`Uint8Array is not 16 bytes long: ${e}`);return new ae(e).readU128()}function Fr(e){if(e.length!=32)throw new Error(`Uint8Array is not 32 bytes long: [${e}]`);return new ae(e).readU256()}function tr(e){e.startsWith("0x")&&(e=e.slice(2));let t=e.match(/.{1,2}/g)||[],i=Uint8Array.from(t.map(s=>parseInt(s,16)));return i.length!=32?new Uint8Array(0):i.reverse()}function Cr(e){return vr(tr(e))}function Br(e){return Fr(tr(e))}function rr(e){let t=new Z(16);return t.writeU128(e),t.getBuffer()}function Er(e){return er(rr(e))}function ir(e){let t=new Z(32);return t.writeU256(e),t.getBuffer()}function Pr(e){return er(ir(e))}var et=class Pe{constructor(t){h(this,"data");this.data=t}get __connection_id__(){return this.data}isZero(){return this.data===BigInt(0)}static nullIfZero(t){return t.isZero()?null:t}static random(){function t(){return Math.floor(Math.random()*255)}let i=BigInt(0);for(let s=0;s<16;s++)i=i<<BigInt(8)|BigInt(t());return new Pe(i)}isEqual(t){return this.data==t.data}toHexString(){return Er(this.data)}toUint8Array(){return rr(this.data)}static fromString(t){return new Pe(Cr(t))}static fromStringOrNull(t){let i=Pe.fromString(t);return i.isZero()?null:i}},G,xr=(G=class{constructor(t){h(this,"__time_duration_micros__");this.__time_duration_micros__=t}get micros(){return this.__time_duration_micros__}get millis(){return Number(this.micros/G.MICROS_PER_MILLIS)}static fromMillis(t){return new G(BigInt(t)*G.MICROS_PER_MILLIS)}},h(G,"MICROS_PER_MILLIS",1000n),G),R,Or=(R=class{constructor(t){h(this,"__timestamp_micros_since_unix_epoch__");this.__timestamp_micros_since_unix_epoch__=t}get microsSinceUnixEpoch(){return this.__timestamp_micros_since_unix_epoch__}static now(){return R.fromDate(new Date)}static fromDate(t){const i=t.getTime(),s=BigInt(i)*R.MICROS_PER_MILLIS;return new R(s)}toDate(){const i=this.__timestamp_micros_since_unix_epoch__/R.MICROS_PER_MILLIS;if(i>BigInt(Number.MAX_SAFE_INTEGER)||i<BigInt(Number.MIN_SAFE_INTEGER))throw new RangeError("Timestamp is outside of the representable range of JS's Date");return new Date(Number(i))}},h(R,"MICROS_PER_MILLIS",1000n),h(R,"UNIX_EPOCH",new R(0n)),R),kr=class nr{constructor(t){h(this,"data");this.data=typeof t=="string"?Br(t):t}get __identity__(){return this.data}isEqual(t){return this.toHexString()===t.toHexString()}toHexString(){return Pr(this.data)}toUint8Array(){return ir(this.data)}static fromString(t){return new nr(t)}},tt;(e=>{function t(){return c.createSumType([new I("Interval",c.createU64Type()),new I("Time",c.createU64Type())])}e.getAlgebraicType=t;function i(r){switch(r.tag){case"Interval":return{Interval:r.value};case"Time":return{Time:r.value};default:throw"unreachable"}}e.serialize=i,e.Interval=r=>({tag:"Interval",value:r}),e.Time=r=>({tag:"Time",value:r});function s(r){let a=r.asSumValue();switch(a.tag){case 0:return{tag:"Interval",value:a.value.asBigInt()};case 1:return{tag:"Time",value:a.value.asBigInt()};default:throw"unreachable"}}e.fromValue=s})(tt||(tt={}));var Rr=tt,I=class{constructor(e,t){h(this,"name");h(this,"algebraicType");this.name=e,this.algebraicType=t}},Mr=class{constructor(e){h(this,"variants");h(this,"serialize",(e,t)=>{if(this.variants.length==2&&this.variants[0].name==="some"&&this.variants[1].name==="none")t!=null?(e.writeByte(0),this.variants[0].algebraicType.serialize(e,t)):e.writeByte(1);else{let i=t.tag;const s=this.variants.findIndex(r=>r.name===i);if(s<0)throw`Can't serialize a sum type, couldn't find ${t.tag} tag`;e.writeU8(s),this.variants[s].algebraicType.serialize(e,t.value)}});h(this,"deserialize",e=>{let t=e.readU8();if(this.variants.length==2&&this.variants[0].name==="some"&&this.variants[1].name==="none"){if(t===0)return this.variants[0].algebraicType.deserialize(e);if(t===1)return;throw`Can't deserialize an option type, couldn't find ${t} tag`}else{let i=this.variants[t],s=i.algebraicType.deserialize(e);return{tag:i.name,value:s}}});this.variants=e}},p=class{constructor(e,t){h(this,"name");h(this,"algebraicType");this.name=e,this.algebraicType=t}},Nr=class{constructor(e){h(this,"elements");h(this,"serialize",(e,t)=>{for(let i of this.elements)i.algebraicType.serialize(e,t[i.name])});h(this,"deserialize",e=>{let t={};if(this.elements.length===1){if(this.elements[0].name==="__time_duration_micros__")return new xr(e.readI64());if(this.elements[0].name==="__timestamp_micros_since_unix_epoch__")return new Or(e.readI64());if(this.elements[0].name==="__identity__")return new kr(e.readU256());if(this.elements[0].name==="__connection_id__")return new et(e.readU128())}for(let i of this.elements)t[i.name]=i.algebraicType.deserialize(e);return t});this.elements=e}isEmpty(){return this.elements.length===0}intoMapKey(e){if(this.elements.length===1){if(this.elements[0].name==="__time_duration_micros__")return e.__time_duration_micros__;if(this.elements[0].name==="__timestamp_micros_since_unix_epoch__")return e.__timestamp_micros_since_unix_epoch__;if(this.elements[0].name==="__identity__")return e.__identity__;if(this.elements[0].name==="__connection_id__")return e.__connection_id__}const t=new Z(10);return this.serialize(t,e),t.toBase64()}},Dr=class{constructor(e,t){h(this,"keyType");h(this,"valueType");this.keyType=e,this.valueType=t}},H,ie,_,ce,v,be,rt,fe,it,me,nt,c=(ce=class{constructor(){g(this,H);g(this,be);g(this,fe);g(this,me);h(this,"type");h(this,"type_")}get product(){if(this.type!==o.ProductType)throw"product type was requested, but the type is not ProductType";return this.type_}set product(t){y(this,H,ie).call(this,o.ProductType,t)}get sum(){if(this.type!==o.SumType)throw"sum type was requested, but the type is not SumType";return this.type_}set sum(t){y(this,H,ie).call(this,o.SumType,t)}get array(){if(this.type!==o.ArrayType)throw"array type was requested, but the type is not ArrayType";return this.type_}set array(t){y(this,H,ie).call(this,o.ArrayType,t)}get map(){if(this.type!==o.MapType)throw"map type was requested, but the type is not MapType";return this.type_}set map(t){y(this,H,ie).call(this,o.MapType,t)}static createProductType(t){return y(this,_,v).call(this,o.ProductType,new Nr(t))}static createSumType(t){return y(this,_,v).call(this,o.SumType,new Mr(t))}static createArrayType(t){return y(this,_,v).call(this,o.ArrayType,t)}static createMapType(t,i){return y(this,_,v).call(this,o.MapType,new Dr(t,i))}static createBoolType(){return y(this,_,v).call(this,o.Bool,null)}static createI8Type(){return y(this,_,v).call(this,o.I8,null)}static createU8Type(){return y(this,_,v).call(this,o.U8,null)}static createI16Type(){return y(this,_,v).call(this,o.I16,null)}static createU16Type(){return y(this,_,v).call(this,o.U16,null)}static createI32Type(){return y(this,_,v).call(this,o.I32,null)}static createU32Type(){return y(this,_,v).call(this,o.U32,null)}static createI64Type(){return y(this,_,v).call(this,o.I64,null)}static createU64Type(){return y(this,_,v).call(this,o.U64,null)}static createI128Type(){return y(this,_,v).call(this,o.I128,null)}static createU128Type(){return y(this,_,v).call(this,o.U128,null)}static createI256Type(){return y(this,_,v).call(this,o.I256,null)}static createU256Type(){return y(this,_,v).call(this,o.U256,null)}static createF32Type(){return y(this,_,v).call(this,o.F32,null)}static createF64Type(){return y(this,_,v).call(this,o.F64,null)}static createStringType(){return y(this,_,v).call(this,o.String,null)}static createBytesType(){return this.createArrayType(this.createU8Type())}static createOptionType(t){return this.createSumType([new I("some",t),new I("none",this.createProductType([]))])}static createIdentityType(){return this.createProductType([new p("__identity__",this.createU256Type())])}static createConnectionIdType(){return this.createProductType([new p("__connection_id__",this.createU128Type())])}static createScheduleAtType(){return Rr.getAlgebraicType()}static createTimestampType(){return this.createProductType([new p("__timestamp_micros_since_unix_epoch__",this.createI64Type())])}static createTimeDurationType(){return this.createProductType([new p("__time_duration_micros__",this.createI64Type())])}isProductType(){return this.type===o.ProductType}isSumType(){return this.type===o.SumType}isArrayType(){return this.type===o.ArrayType}isMapType(){return this.type===o.MapType}isIdentity(){return y(this,fe,it).call(this,"__identity__")}isConnectionId(){return y(this,fe,it).call(this,"__connection_id__")}isScheduleAt(){return this.isSumType()&&this.sum.variants.length===2&&this.sum.variants[0].name==="Interval"&&this.sum.variants[0].algebraicType.type===o.U64&&this.sum.variants[1].name==="Time"&&this.sum.variants[1].algebraicType.type===o.U64}isTimestamp(){return y(this,me,nt).call(this,"__timestamp_micros_since_unix_epoch__")}isTimeDuration(){return y(this,me,nt).call(this,"__time_duration_micros__")}intoMapKey(t){switch(this.type){case o.U8:case o.U16:case o.U32:case o.U64:case o.U128:case o.U256:case o.I8:case o.I16:case o.I64:case o.I128:case o.F32:case o.F64:case o.String:case o.Bool:return t;case o.ProductType:return this.product.intoMapKey(t);default:const i=new Z(10);return this.serialize(i,t),i.toBase64()}}serialize(t,i){switch(this.type){case o.ProductType:this.product.serialize(t,i);break;case o.SumType:this.sum.serialize(t,i);break;case o.ArrayType:if(y(this,be,rt).call(this))t.writeUInt8Array(i);else{const s=this.array;t.writeU32(i.length);for(let r of i)s.serialize(t,r)}break;case o.MapType:throw new Error("not implemented");case o.Bool:t.writeBool(i);break;case o.I8:t.writeI8(i);break;case o.U8:t.writeU8(i);break;case o.I16:t.writeI16(i);break;case o.U16:t.writeU16(i);break;case o.I32:t.writeI32(i);break;case o.U32:t.writeU32(i);break;case o.I64:t.writeI64(i);break;case o.U64:t.writeU64(i);break;case o.I128:t.writeI128(i);break;case o.U128:t.writeU128(i);break;case o.I256:t.writeI256(i);break;case o.U256:t.writeU256(i);break;case o.F32:t.writeF32(i);break;case o.F64:t.writeF64(i);break;case o.String:t.writeString(i);break;default:throw new Error(`not implemented, ${this.type}`)}}deserialize(t){switch(this.type){case o.ProductType:return this.product.deserialize(t);case o.SumType:return this.sum.deserialize(t);case o.ArrayType:if(y(this,be,rt).call(this))return t.readUInt8Array();{const i=this.array,s=t.readU32();let r=[];for(let a=0;a<s;a++)r.push(i.deserialize(t));return r}case o.MapType:throw new Error("not implemented");case o.Bool:return t.readBool();case o.I8:return t.readI8();case o.U8:return t.readU8();case o.I16:return t.readI16();case o.U16:return t.readU16();case o.I32:return t.readI32();case o.U32:return t.readU32();case o.I64:return t.readI64();case o.U64:return t.readU64();case o.I128:return t.readI128();case o.U128:return t.readU128();case o.U256:return t.readU256();case o.F32:return t.readF32();case o.F64:return t.readF64();case o.String:return t.readString();default:throw new Error(`not implemented, ${this.type}`)}}},H=new WeakSet,ie=function(t,i){this.type_=i,this.type=i===void 0?o.None:t},_=new WeakSet,v=function(t,i){var r;let s=new ce;return y(r=s,H,ie).call(r,t,i),s},be=new WeakSet,rt=function(){return this.isArrayType()&&this.array.type==o.U8},fe=new WeakSet,it=function(t){return this.isProductType()&&this.product.elements.length===1&&(this.product.elements[0].algebraicType.type==o.U128||this.product.elements[0].algebraicType.type==o.U256)&&this.product.elements[0].name===t},me=new WeakSet,nt=function(t){return this.isProductType()&&this.product.elements.length===1&&this.product.elements[0].algebraicType.type===o.I64&&this.product.elements[0].name===t},g(ce,_),ce);(e=>{(t=>{t.SumType="SumType",t.ProductType="ProductType",t.ArrayType="ArrayType",t.MapType="MapType",t.Bool="Bool",t.I8="I8",t.U8="U8",t.I16="I16",t.U16="U16",t.I32="I32",t.U32="U32",t.I64="I64",t.U64="U64",t.I128="I128",t.U128="U128",t.I256="I256",t.U256="U256",t.F32="F32",t.F64="F64",t.String="String",t.None="None"})(e.Type||(e.Type={}))})(c||(c={}));var o=c.Type;function qr(e,t){const i=new ae(t);return e.deserialize(i)}var st;(e=>{e.FixedSize=r=>({tag:"FixedSize",value:r}),e.RowOffsets=r=>({tag:"RowOffsets",value:r});function t(){return c.createSumType([new I("FixedSize",c.createU16Type()),new I("RowOffsets",c.createArrayType(c.createU64Type()))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(st||(st={}));var Te;(e=>{function t(){return c.createProductType([new p("sizeHint",st.getTypeScriptAlgebraicType()),new p("rowsData",c.createArrayType(c.createU8Type()))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(Te||(Te={}));var at;(e=>{function t(){return c.createProductType([new p("reducer",c.createStringType()),new p("args",c.createArrayType(c.createU8Type())),new p("requestId",c.createU32Type()),new p("flags",c.createU8Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(at||(at={}));var ct;(e=>{function t(){return c.createProductType([new p("queryStrings",c.createArrayType(c.createStringType())),new p("requestId",c.createU32Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(ct||(ct={}));var ot;(e=>{function t(){return c.createProductType([new p("messageId",c.createArrayType(c.createU8Type())),new p("queryString",c.createStringType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(ot||(ot={}));var D;(e=>{function t(){return c.createProductType([new p("id",c.createU32Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(D||(D={}));var pt;(e=>{function t(){return c.createProductType([new p("query",c.createStringType()),new p("requestId",c.createU32Type()),new p("queryId",D.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(pt||(pt={}));var lt;(e=>{function t(){return c.createProductType([new p("queryStrings",c.createArrayType(c.createStringType())),new p("requestId",c.createU32Type()),new p("queryId",D.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(lt||(lt={}));var ut;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("queryId",D.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(ut||(ut={}));var dt;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("queryId",D.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(dt||(dt={}));var ne;(e=>{e.CallReducer=r=>({tag:"CallReducer",value:r}),e.Subscribe=r=>({tag:"Subscribe",value:r}),e.OneOffQuery=r=>({tag:"OneOffQuery",value:r}),e.SubscribeSingle=r=>({tag:"SubscribeSingle",value:r}),e.SubscribeMulti=r=>({tag:"SubscribeMulti",value:r}),e.Unsubscribe=r=>({tag:"Unsubscribe",value:r}),e.UnsubscribeMulti=r=>({tag:"UnsubscribeMulti",value:r});function t(){return c.createSumType([new I("CallReducer",at.getTypeScriptAlgebraicType()),new I("Subscribe",ct.getTypeScriptAlgebraicType()),new I("OneOffQuery",ot.getTypeScriptAlgebraicType()),new I("SubscribeSingle",pt.getTypeScriptAlgebraicType()),new I("SubscribeMulti",lt.getTypeScriptAlgebraicType()),new I("Unsubscribe",ut.getTypeScriptAlgebraicType()),new I("UnsubscribeMulti",dt.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(ne||(ne={}));var ke;(e=>{function t(){return c.createProductType([new p("deletes",Te.getTypeScriptAlgebraicType()),new p("inserts",Te.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(ke||(ke={}));var yt;(e=>{e.Uncompressed=r=>({tag:"Uncompressed",value:r}),e.Brotli=r=>({tag:"Brotli",value:r}),e.Gzip=r=>({tag:"Gzip",value:r});function t(){return c.createSumType([new I("Uncompressed",ke.getTypeScriptAlgebraicType()),new I("Brotli",c.createArrayType(c.createU8Type())),new I("Gzip",c.createArrayType(c.createU8Type()))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(yt||(yt={}));var Re;(e=>{function t(){return c.createProductType([new p("tableId",c.createU32Type()),new p("tableName",c.createStringType()),new p("numRows",c.createU64Type()),new p("updates",c.createArrayType(yt.getTypeScriptAlgebraicType()))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(Re||(Re={}));var te;(e=>{function t(){return c.createProductType([new p("tables",c.createArrayType(Re.getTypeScriptAlgebraicType()))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(te||(te={}));var ht;(e=>{function t(){return c.createProductType([new p("databaseUpdate",te.getTypeScriptAlgebraicType()),new p("requestId",c.createU32Type()),new p("totalHostExecutionDuration",c.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(ht||(ht={}));var gt;(e=>{e.Committed=r=>({tag:"Committed",value:r}),e.Failed=r=>({tag:"Failed",value:r}),e.OutOfEnergy={tag:"OutOfEnergy"};function t(){return c.createSumType([new I("Committed",te.getTypeScriptAlgebraicType()),new I("Failed",c.createStringType()),new I("OutOfEnergy",c.createProductType([]))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(gt||(gt={}));var Tt;(e=>{function t(){return c.createProductType([new p("reducerName",c.createStringType()),new p("reducerId",c.createU32Type()),new p("args",c.createArrayType(c.createU8Type())),new p("requestId",c.createU32Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(Tt||(Tt={}));var bt;(e=>{function t(){return c.createProductType([new p("quanta",c.createU128Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(bt||(bt={}));var ft;(e=>{function t(){return c.createProductType([new p("status",gt.getTypeScriptAlgebraicType()),new p("timestamp",c.createTimestampType()),new p("callerIdentity",c.createIdentityType()),new p("callerConnectionId",c.createConnectionIdType()),new p("reducerCall",Tt.getTypeScriptAlgebraicType()),new p("energyQuantaUsed",bt.getTypeScriptAlgebraicType()),new p("totalHostExecutionDuration",c.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(ft||(ft={}));var mt;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("update",te.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(mt||(mt={}));var wt;(e=>{function t(){return c.createProductType([new p("identity",c.createIdentityType()),new p("token",c.createStringType()),new p("connectionId",c.createConnectionIdType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(wt||(wt={}));var St;(e=>{function t(){return c.createProductType([new p("tableName",c.createStringType()),new p("rows",Te.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(St||(St={}));var At;(e=>{function t(){return c.createProductType([new p("messageId",c.createArrayType(c.createU8Type())),new p("error",c.createOptionType(c.createStringType())),new p("tables",c.createArrayType(St.getTypeScriptAlgebraicType())),new p("totalHostExecutionDuration",c.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(At||(At={}));var Me;(e=>{function t(){return c.createProductType([new p("tableId",c.createU32Type()),new p("tableName",c.createStringType()),new p("tableRows",Re.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(Me||(Me={}));var It;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("totalHostExecutionDurationMicros",c.createU64Type()),new p("queryId",D.getTypeScriptAlgebraicType()),new p("rows",Me.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(It||(It={}));var zt;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("totalHostExecutionDurationMicros",c.createU64Type()),new p("queryId",D.getTypeScriptAlgebraicType()),new p("rows",Me.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(zt||(zt={}));var _t;(e=>{function t(){return c.createProductType([new p("totalHostExecutionDurationMicros",c.createU64Type()),new p("requestId",c.createOptionType(c.createU32Type())),new p("queryId",c.createOptionType(c.createU32Type())),new p("tableId",c.createOptionType(c.createU32Type())),new p("error",c.createStringType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(_t||(_t={}));var Ut;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("totalHostExecutionDurationMicros",c.createU64Type()),new p("queryId",D.getTypeScriptAlgebraicType()),new p("update",te.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(Ut||(Ut={}));var vt;(e=>{function t(){return c.createProductType([new p("requestId",c.createU32Type()),new p("totalHostExecutionDurationMicros",c.createU64Type()),new p("queryId",D.getTypeScriptAlgebraicType()),new p("update",te.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(vt||(vt={}));var Ft;(e=>{e.InitialSubscription=r=>({tag:"InitialSubscription",value:r}),e.TransactionUpdate=r=>({tag:"TransactionUpdate",value:r}),e.TransactionUpdateLight=r=>({tag:"TransactionUpdateLight",value:r}),e.IdentityToken=r=>({tag:"IdentityToken",value:r}),e.OneOffQueryResponse=r=>({tag:"OneOffQueryResponse",value:r}),e.SubscribeApplied=r=>({tag:"SubscribeApplied",value:r}),e.UnsubscribeApplied=r=>({tag:"UnsubscribeApplied",value:r}),e.SubscriptionError=r=>({tag:"SubscriptionError",value:r}),e.SubscribeMultiApplied=r=>({tag:"SubscribeMultiApplied",value:r}),e.UnsubscribeMultiApplied=r=>({tag:"UnsubscribeMultiApplied",value:r});function t(){return c.createSumType([new I("InitialSubscription",ht.getTypeScriptAlgebraicType()),new I("TransactionUpdate",ft.getTypeScriptAlgebraicType()),new I("TransactionUpdateLight",mt.getTypeScriptAlgebraicType()),new I("IdentityToken",wt.getTypeScriptAlgebraicType()),new I("OneOffQueryResponse",At.getTypeScriptAlgebraicType()),new I("SubscribeApplied",It.getTypeScriptAlgebraicType()),new I("UnsubscribeApplied",zt.getTypeScriptAlgebraicType()),new I("SubscriptionError",_t.getTypeScriptAlgebraicType()),new I("SubscribeMultiApplied",Ut.getTypeScriptAlgebraicType()),new I("UnsubscribeMultiApplied",vt.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(Ft||(Ft={}));var Y,Zt,Ye=(Zt=class{constructor(){g(this,Y,new Map)}on(e,t){let i=n(this,Y).get(e);i||(i=new Set,n(this,Y).set(e,i)),i.add(t)}off(e,t){let i=n(this,Y).get(e);i&&i.delete(t)}emit(e,...t){let i=n(this,Y).get(e);if(i)for(let s of i)s(...t)}},Y=new WeakMap,Zt),$r={component:"📦",info:"ℹ️",warn:"⚠️",error:"❌",debug:"🐛"},Lr={component:"color: #fff; background-color: #8D6FDD; padding: 2px 5px; border-radius: 3px;",info:"color: #fff; background-color: #007bff; padding: 2px 5px; border-radius: 3px;",warn:"color: #fff; background-color: #ffc107; padding: 2px 5px; border-radius: 3px;",error:"color: #fff; background-color: #dc3545; padding: 2px 5px; border-radius: 3px;",debug:"color: #fff; background-color: #28a745; padding: 2px 5px; border-radius: 3px;"},Hr={component:"color: #8D6FDD;",info:"color: #007bff;",warn:"color: #ffc107;",error:"color: #dc3545;",debug:"color: #28a745;"},j=(e,t)=>{console.log(`%c${$r[e]} ${e.toUpperCase()}%c ${t}`,Lr[e],Hr[e])},Vr=class{constructor(e){h(this,"rows");h(this,"tableTypeInfo");h(this,"emitter");h(this,"applyOperations",(e,t)=>{const i=[];if(this.tableTypeInfo.primaryKeyInfo!==void 0){const s=new Map,r=new Map;for(const a of e)if(a.type==="insert"){const[l,u]=s.get(a.rowId)||[a,0];s.set(a.rowId,[a,u+1])}else{const[l,u]=r.get(a.rowId)||[a,0];r.set(a.rowId,[a,u+1])}for(const[a,[l,u]]of s){const T=r.get(a);if(T){const[b,w]=T,z=u-w,U=this.update(t,a,l.row,z);U&&i.push(U),r.delete(a)}else{const b=this.insert(t,l,u);b&&i.push(b)}}for(const[a,l]of r.values()){const u=this.delete(t,a,l);u&&i.push(u)}}else for(const s of e)if(s.type==="insert"){const r=this.insert(t,s);r&&i.push(r)}else{const r=this.delete(t,s);r&&i.push(r)}return i});h(this,"update",(e,t,i,s=0)=>{const r=this.rows.get(t);if(!r){j("error",`Updating a row that was not present in the cache. Table: ${this.tableTypeInfo.tableName}, RowId: ${t}`);return}const[a,l]=r,u=Math.max(1,l+s);if(l+s<=0){j("error",`Negative reference count for in table ${this.tableTypeInfo.tableName} row ${t} (${l} + ${s})`);return}return this.rows.set(t,[i,u]),l===0?(j("error",`Updating a row id in table ${this.tableTypeInfo.tableName} which was not present in the cache (rowId: ${t})`),{type:"insert",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("insert",e,i)}}):{type:"update",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("update",e,a,i)}}});h(this,"insert",(e,t,i=1)=>{const[s,r]=this.rows.get(t.rowId)||[t.row,0];if(this.rows.set(t.rowId,[t.row,r+i]),r===0)return{type:"insert",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("insert",e,t.row)}}});h(this,"delete",(e,t,i=1)=>{const[s,r]=this.rows.get(t.rowId)||[t.row,0];if(r===0){j("warn","Deleting a row that was not present in the cache");return}if(r<=i)return this.rows.delete(t.rowId),{type:"delete",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("delete",e,t.row)}};this.rows.set(t.rowId,[t.row,r-i])});h(this,"onInsert",e=>{this.emitter.on("insert",e)});h(this,"onDelete",e=>{this.emitter.on("delete",e)});h(this,"onUpdate",e=>{this.emitter.on("update",e)});h(this,"removeOnInsert",e=>{this.emitter.off("insert",e)});h(this,"removeOnDelete",e=>{this.emitter.off("delete",e)});h(this,"removeOnUpdate",e=>{this.emitter.off("update",e)});this.tableTypeInfo=e,this.rows=new Map,this.emitter=new Ye}count(){return this.rows.size}iter(){return Array.from(this.rows.values()).map(([e])=>e)}},Wr=class{constructor(){h(this,"tables");this.tables=new Map}getTable(e){const t=this.tables.get(e);if(!t)throw console.error("The table has not been registered for this client. Please register the table before using it. If you have registered global tables using the SpacetimeDBClient.registerTables() or `registerTable()` method, please make sure that is executed first!"),new Error(`Table ${e} does not exist`);return t}getOrCreateTable(e){let t;return this.tables.has(e.tableName)?t=this.tables.get(e.tableName):(t=new Vr(e),this.tables.set(e.tableName,t)),t}};function Kr(e,t){const i=Math.min(e.length,t.length);for(let s=0;s<i;s++){const r=e[s],a=t[s];if(r!==a)return typeof r=="number"&&typeof a=="number"?r-a:typeof r=="string"&&typeof a=="string"?r.localeCompare(a):typeof r=="string"?1:-1}return e.length-t.length}var sr=class Ct{constructor(t,i,s,r=null,a=null){h(this,"major");h(this,"minor");h(this,"patch");h(this,"preRelease");h(this,"buildInfo");this.major=t,this.minor=i,this.patch=s,this.preRelease=r,this.buildInfo=a}toString(){let t=`${this.major}.${this.minor}.${this.patch}`;return this.preRelease&&(t+=`-${this.preRelease.join(".")}`),this.buildInfo&&(t+=`+${this.buildInfo}`),t}compare(t){return this.major!==t.major?this.major-t.major:this.minor!==t.minor?this.minor-t.minor:this.patch!==t.patch?this.patch-t.patch:this.preRelease&&t.preRelease?Kr(this.preRelease,t.preRelease):this.preRelease||t.preRelease?-1:0}clone(){return new Ct(this.major,this.minor,this.patch,this.preRelease?[...this.preRelease]:null,this.buildInfo)}static parseVersionString(t){const i=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-([\da-zA-Z-]+(?:\.[\da-zA-Z-]+)*))?(?:\+([\da-zA-Z-]+(?:\.[\da-zA-Z-]+)*))?$/,s=t.match(i);if(!s)throw new Error(`Invalid version string: ${t}`);const r=parseInt(s[1],10),a=parseInt(s[2],10),l=parseInt(s[3],10),u=s[4]?s[4].split(".").map(b=>isNaN(Number(b))?b:Number(b)):null,T=s[5]||null;return new Ct(r,a,l,u,T)}},ar=new sr(1,2,0);function jr(e){if(e===void 0)throw new Error(Wt(e));if(sr.parseVersionString(e).compare(ar)<0)throw new Error(Wt(e))}function Wt(e){return`Module code was generated with an incompatible version of the spacetimedb cli (${e}).  Update the cli version to at least ${ar.toString()} and regenerate the bindings. You can upgrade to the latest cli version by running: spacetime version upgrade`}async function cr(e,t,i=128*1024){let s=0;const r=new ReadableStream({pull(E){if(s<e.length){const P=e.subarray(s,Math.min(s+i,e.length));E.enqueue(P),s+=i}else E.close()}}),a=new DecompressionStream(t),u=r.pipeThrough(a).getReader(),T=[];let b=0,w;for(;!(w=await u.read()).done;)T.push(w.value),b+=w.value.length;const z=new Uint8Array(b);let U=0;for(const E of T)z.set(E,U),U+=E.length;return z}var oe,He,or,Ve,pr,we,Bt,Se,Zr=(Se=class{constructor(t){g(this,He);g(this,Ve);g(this,we);h(this,"onclose");h(this,"onopen");h(this,"onmessage");h(this,"onerror");g(this,oe,void 0);this.onmessage=void 0,this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,t.onmessage=y(this,He,or).bind(this),t.onerror=y(this,we,Bt).bind(this),t.onclose=y(this,we,Bt).bind(this),t.onopen=y(this,Ve,pr).bind(this),t.binaryType="arraybuffer",d(this,oe,t)}send(t){n(this,oe).send(t)}close(){n(this,oe).close()}static async createWebSocketFn({url:t,nameOrAddress:i,wsProtocol:s,authToken:r,compression:a,lightMode:l}){const u=new Headers;let T;T=WebSocket;let b;if(r){u.set("Authorization",`Bearer ${r}`);const U=new URL("v1/identity/websocket-token",t);U.protocol=t.protocol==="wss:"?"https:":"http:";const E=await fetch(U,{method:"POST",headers:u});if(E.ok){const{token:P}=await E.json();b=P}else return Promise.reject(new Error(`Failed to verify token: ${E.statusText}`))}const w=new URL(`v1/database/${i}/subscribe`,t);b&&w.searchParams.set("token",b),w.searchParams.set("compression",a==="gzip"?"Gzip":"None"),l&&w.searchParams.set("light","true");const z=new T(w.toString(),s);return new Se(z)}},oe=new WeakMap,He=new WeakSet,or=async function(t){const i=new Uint8Array(t.data);let s;if(i[0]===0)s=i.slice(1);else{if(i[0]===1)throw new Error("Brotli Compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");if(i[0]===2)s=await cr(i.slice(1),"gzip");else throw new Error("Unexpected Compression Algorithm. Please use `gzip` or `none`")}this.onmessage?.({data:s})},Ve=new WeakSet,pr=function(t){this.onopen?.(t)},we=new WeakSet,Bt=function(t){this.onerror?.(t)},Se),pe,le,We,Ae,Q,Ie,ze,ue,Gt,Gr=(Gt=class{constructor(e,t){g(this,pe,void 0);g(this,le,void 0);g(this,We,void 0);g(this,Ae,void 0);g(this,Q,new Ye);g(this,Ie,"gzip");g(this,ze,!1);g(this,ue,void 0);this.remoteModule=e,this.dbConnectionConstructor=t,d(this,ue,Zr.createWebSocketFn)}withUri(e){return d(this,pe,new URL(e)),this}withModuleName(e){return d(this,le,e),this}withToken(e){return d(this,Ae,e),this}withWSFn(e){return d(this,ue,e),this}withCompression(e){return d(this,Ie,e),this}withLightMode(e){return d(this,ze,e),this}onConnect(e){return n(this,Q).on("connect",e),this}onConnectError(e){return n(this,Q).on("connectError",e),this}onDisconnect(e){return n(this,Q).on("disconnect",e),this}build(){if(!n(this,pe))throw new Error("URI is required to connect to SpacetimeDB");if(!n(this,le))throw new Error("Database name or address is required to connect to SpacetimeDB");return jr(this.remoteModule.versionInfo?.cliVersion),this.dbConnectionConstructor(new ur({uri:n(this,pe),nameOrAddress:n(this,le),identity:n(this,We),token:n(this,Ae),emitter:n(this,Q),compression:n(this,Ie),lightMode:n(this,ze),createWSFn:n(this,ue),remoteModule:this.remoteModule}))}},pe=new WeakMap,le=new WeakMap,We=new WeakMap,Ae=new WeakMap,Q=new WeakMap,Ie=new WeakMap,ze=new WeakMap,ue=new WeakMap,Gt),_e,Ue,Xt,lr=(Xt=class{constructor(e){g(this,_e,void 0);g(this,Ue,void 0);this.db=e}onApplied(e){return d(this,_e,e),this}onError(e){return d(this,Ue,e),this}subscribe(e){const t=Array.isArray(e)?e:[e];if(t.length===0)throw new Error("Subscriptions must have at least one query");return new Jr(this.db,t,n(this,_e),n(this,Ue))}subscribeToAllTables(){this.subscribe("SELECT * FROM *")}},_e=new WeakMap,Ue=new WeakMap,Xt),Xr=class{constructor(){h(this,"subscriptions",new Map)}},de,ee,V,W,K,Jt,Jr=(Jt=class{constructor(e,t,i,s){g(this,de,void 0);g(this,ee,!1);g(this,V,!1);g(this,W,!1);g(this,K,new Ye);this.db=e,n(this,K).on("applied",r=>{d(this,W,!0),i&&i(r)}),n(this,K).on("error",(r,a)=>{d(this,W,!1),d(this,V,!0),s&&s(r,a)}),d(this,de,this.db.registerSubscription(this,n(this,K),t))}unsubscribe(){if(n(this,ee))throw new Error("Unsubscribe has already been called");d(this,ee,!0),this.db.unregisterSubscription(n(this,de)),n(this,K).on("end",e=>{d(this,V,!0),d(this,W,!1)})}unsubscribeThen(e){if(n(this,V))throw new Error("Subscription has already ended");if(n(this,ee))throw new Error("Unsubscribe has already been called");d(this,ee,!0),this.db.unregisterSubscription(n(this,de)),n(this,K).on("end",t=>{d(this,V,!0),d(this,W,!1),e(t)})}isEnded(){return n(this,V)}isActive(){return n(this,W)}},de=new WeakMap,ee=new WeakMap,V=new WeakMap,W=new WeakMap,K=new WeakMap,Jt);function Yr(e){switch(e){case"FullUpdate":return 0;case"NoSuccessNotify":return 1}}var ve,O,ye,Ke,x,Fe,M,je,Ze,dr,he,xe,Ge,yr,q,J,Xe,hr,Je,gr,kt,Qr,Rt,ei,Mt,ti,Nt,ri,Dt,ii,qt,ni,$t,si,Lt,ai,Yt,ur=(Yt=class{constructor({uri:e,nameOrAddress:t,identity:i,token:s,emitter:r,remoteModule:a,createWSFn:l,compression:u,lightMode:T}){g(this,Ze);g(this,he);g(this,Ge);g(this,q);g(this,Xe);g(this,Je);g(this,kt);g(this,Rt);g(this,Mt);g(this,Nt);g(this,Dt);g(this,qt);g(this,$t);g(this,Lt);h(this,"isActive",!1);h(this,"identity");h(this,"token");h(this,"db");h(this,"reducers");h(this,"setReducerFlags");h(this,"connectionId",et.random());g(this,ve,0);g(this,O,void 0);g(this,ye,new Ye);g(this,Ke,void 0);g(this,x,void 0);g(this,Fe,Promise.resolve());g(this,M,new Xr);h(this,"clientCache");h(this,"ws");h(this,"wsPromise");g(this,je,()=>{const e=n(this,ve);return d(this,ve,n(this,ve)+1),e});h(this,"subscriptionBuilder",()=>new lr(this));j("info","Connecting to SpacetimeDB WS...");let b=new URL(e);/^wss?:/.test(e.protocol)||(b.protocol=b.protocol==="https:"?"wss:":"ws:"),this.identity=i,this.token=s,d(this,x,a),d(this,O,r);let w=this.connectionId.toHexString();b.searchParams.set("connection_id",w),this.clientCache=new Wr,this.db=n(this,x).dbViewConstructor(this),this.setReducerFlags=n(this,x).setReducerFlagsConstructor(),this.reducers=n(this,x).reducersConstructor(this,this.setReducerFlags),this.wsPromise=l({url:b,nameOrAddress:t,wsProtocol:"v1.bsatn.spacetimedb",authToken:s,compression:u,lightMode:T}).then(z=>(this.ws=z,this.ws.onclose=()=>{n(this,O).emit("disconnect",this)},this.ws.onerror=U=>{n(this,O).emit("connectError",this,U)},this.ws.onopen=y(this,Ge,yr).bind(this),this.ws.onmessage=y(this,Je,gr).bind(this),z)).catch(z=>{j("error","Error connecting to SpacetimeDB WS"),n(this,O).emit("connectError",this,z)})}registerSubscription(e,t,i){const s=n(this,je).call(this);return n(this,M).subscriptions.set(s,{handle:e,emitter:t}),y(this,he,xe).call(this,ne.SubscribeMulti({queryStrings:i,queryId:{id:s},requestId:0})),s}unregisterSubscription(e){y(this,he,xe).call(this,ne.UnsubscribeMulti({queryId:{id:e},requestId:0}))}callReducer(e,t,i){const s=ne.CallReducer({reducer:e,args:t,requestId:0,flags:Yr(i)});y(this,he,xe).call(this,s)}disconnect(){this.wsPromise.then(e=>{e&&e.close()})}onReducer(e,t){n(this,ye).on(e,t)}offReducer(e,t){n(this,ye).off(e,t)}},ve=new WeakMap,O=new WeakMap,ye=new WeakMap,Ke=new WeakMap,x=new WeakMap,Fe=new WeakMap,M=new WeakMap,je=new WeakMap,Ze=new WeakSet,dr=async function(e){const t=(r,a,l)=>{const u=l.rowsData,T=new ae(u),b=[],w=n(this,x).tables[a].rowType,z=n(this,x).tables[a].primaryKeyInfo;for(;T.offset<u.length+u.byteOffset;){const U=T.offset,E=w.deserialize(T);let P;if(z!==void 0)P=z.colType.intoMapKey(E[z.colName]);else{const re=u.subarray(U-u.byteOffset,T.offset-u.byteOffset);P=Qt(re)}b.push({type:r,rowId:P,row:E})}return b},i=async r=>{const a=r.tableName;let l=[];for(const u of r.updates){let T;if(u.tag==="Gzip"){const b=await cr(u.value,"gzip");T=ke.deserialize(new ae(b))}else{if(u.tag==="Brotli")throw new Error("Brotli compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");T=u.value}l=l.concat(t("insert",a,T.inserts)),l=l.concat(t("delete",a,T.deletes))}return{tableName:a,operations:l}},s=async r=>{const a=[];for(const l of r.tables)a.push(await i(l));return a};switch(e.tag){case"InitialSubscription":{const r=e.value.databaseUpdate;return{tag:"InitialSubscription",tableUpdates:await s(r)}}case"TransactionUpdateLight":{const r=e.value.update;return{tag:"TransactionUpdateLight",tableUpdates:await s(r)}}case"TransactionUpdate":{const r=e.value,a=r.callerIdentity,l=et.nullIfZero(r.callerConnectionId),u=r.reducerCall.reducerName,T=r.reducerCall.args,b=r.energyQuantaUsed;let w,z="";switch(r.status.tag){case"Committed":w=await s(r.status.value);break;case"Failed":w=[],z=r.status.value;break;case"OutOfEnergy":w=[];break}if(u==="<none>"){console.error(`Received an error from the database: ${z}`);return}let U;return u!==""&&(U={reducerName:u,args:T}),{tag:"TransactionUpdate",tableUpdates:w,identity:a,connectionId:l,reducerInfo:U,status:r.status,energyConsumed:b.quanta,message:z,timestamp:r.timestamp}}case"IdentityToken":return{tag:"IdentityToken",identity:e.value.identity,token:e.value.token,connectionId:e.value.connectionId};case"OneOffQueryResponse":throw new Error(`TypeScript SDK never sends one-off queries, but got OneOffQueryResponse ${e}`);case"SubscribeMultiApplied":{const r=await s(e.value.update);return{tag:"SubscribeApplied",queryId:e.value.queryId.id,tableUpdates:r}}case"UnsubscribeMultiApplied":{const r=await s(e.value.update);return{tag:"UnsubscribeApplied",queryId:e.value.queryId.id,tableUpdates:r}}case"SubscriptionError":return{tag:"SubscriptionError",queryId:e.value.queryId,error:e.value.error}}},he=new WeakSet,xe=function(e){this.wsPromise.then(t=>{if(t){const i=new Z(1024);ne.serialize(i,e);const s=i.getBuffer();t.send(s)}})},Ge=new WeakSet,yr=function(){this.isActive=!0},q=new WeakSet,J=function(e,t){let i=[];for(let s of e){const r=s.tableName,a=n(this,x).tables[r],u=this.clientCache.getOrCreateTable(a).applyOperations(s.operations,t);for(const T of u)i.push(T)}return i},Xe=new WeakSet,hr=async function(e){var s;const t=qr(Ft,e),i=await y(this,Ze,dr).call(this,t);if(i)switch(i.tag){case"InitialSubscription":{let r={tag:"SubscribeApplied"};const a=n(this,x).eventContextConstructor(this,r),{event:l,...u}=a,T=y(this,q,J).call(this,i.tableUpdates,a);n(this,O)&&((s=n(this,Ke))==null||s.call(this,u));for(const b of T)b.cb();break}case"TransactionUpdateLight":{let r={tag:"UnknownTransaction"};const a=n(this,x).eventContextConstructor(this,r),l=y(this,q,J).call(this,i.tableUpdates,a);for(const u of l)u.cb();break}case"TransactionUpdate":{let r=i.reducerInfo,a=!1,l,u;if(!r)a=!0;else{u=n(this,x).reducers[r.reducerName];try{const P=new ae(r.args);l=u.argsType.deserialize(P)}catch{console.debug("Failed to deserialize reducer arguments"),a=!0}}if(a){const P={tag:"UnknownTransaction"},re=n(this,x).eventContextConstructor(this,P),Ce=y(this,q,J).call(this,i.tableUpdates,re);for(const X of Ce)X.cb();return}r=r,u=u;const T={callerIdentity:i.identity,status:i.status,callerConnectionId:i.connectionId,timestamp:i.timestamp,energyConsumed:i.energyConsumed,reducer:{name:r.reducerName,args:l}},b={tag:"Reducer",value:T},w=n(this,x).eventContextConstructor(this,b),z={...w,event:T},U=y(this,q,J).call(this,i.tableUpdates,w),E=[];u.argsType.product.elements.forEach((P,re)=>{E.push(l[P.name])}),n(this,ye).emit(r.reducerName,z,...E);for(const P of U)P.cb();break}case"IdentityToken":{this.identity=i.identity,!this.token&&i.token&&(this.token=i.token),this.connectionId=i.connectionId,n(this,O).emit("connect",this,this.identity,this.token);break}case"SubscribeApplied":{const r=n(this,M).subscriptions.get(i.queryId);if(r===void 0){j("error",`Received SubscribeApplied for unknown queryId ${i.queryId}.`);break}const a={tag:"SubscribeApplied"},l=n(this,x).eventContextConstructor(this,a),{event:u,...T}=l,b=y(this,q,J).call(this,i.tableUpdates,l);r?.emitter.emit("applied",T);for(const w of b)w.cb();break}case"UnsubscribeApplied":{const r=n(this,M).subscriptions.get(i.queryId);if(r===void 0){j("error",`Received UnsubscribeApplied for unknown queryId ${i.queryId}.`);break}const a={tag:"UnsubscribeApplied"},l=n(this,x).eventContextConstructor(this,a),{event:u,...T}=l,b=y(this,q,J).call(this,i.tableUpdates,l);r?.emitter.emit("end",T),n(this,M).subscriptions.delete(i.queryId);for(const w of b)w.cb();break}case"SubscriptionError":{const r=Error(i.error),a={tag:"Error",value:r},u={...n(this,x).eventContextConstructor(this,a),event:r};i.queryId!==void 0?(n(this,M).subscriptions.get(i.queryId)?.emitter.emit("error",u,r),n(this,M).subscriptions.delete(i.queryId)):(console.error("Received an error message without a queryId: ",r),n(this,M).subscriptions.forEach(({emitter:T})=>{T.emit("error",u,r)}))}}},Je=new WeakSet,gr=function(e){d(this,Fe,n(this,Fe).then(()=>y(this,Xe,hr).call(this,e.data)))},kt=new WeakSet,Qr=function(e,t){n(this,O).on(e,t)},Rt=new WeakSet,ei=function(e,t){n(this,O).off(e,t)},Mt=new WeakSet,ti=function(e){n(this,O).on("connect",e)},Nt=new WeakSet,ri=function(e){n(this,O).on("disconnect",e)},Dt=new WeakSet,ii=function(e){n(this,O).on("connectError",e)},qt=new WeakSet,ni=function(e){n(this,O).off("connect",e)},$t=new WeakSet,si=function(e){n(this,O).off("disconnect",e)},Lt=new WeakSet,ai=function(e){n(this,O).off("connectError",e)},Yt),Ne;(e=>{function t(){return c.createProductType([new p("name",c.createStringType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(Ne||(Ne={}));var De;(e=>{function t(){return c.createProductType([new p("id",c.createU256Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(De||(De={}));var qe;(e=>{function t(){return c.createProductType([new p("id",c.createU256Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(qe||(qe={}));var Et;(e=>{function t(){return c.createProductType([])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(Et||(Et={}));var Pt;(e=>{function t(){return c.createProductType([])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(Pt||(Pt={}));var xt;(e=>{function t(){return c.createProductType([])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(xt||(xt={}));var ci=Object.defineProperty,oi=(e,t,i)=>t in e?ci(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,$=(e,t,i)=>(oi(e,typeof t!="symbol"?t+"":t,i),i);class pi{constructor(t){$(this,"tableCache"),$(this,"id",{find:i=>{for(let s of this.tableCache.iter())if(Ht(s.id,i))return s}}),$(this,"onInsert",i=>this.tableCache.onInsert(i)),$(this,"removeOnInsert",i=>this.tableCache.removeOnInsert(i)),$(this,"onDelete",i=>this.tableCache.onDelete(i)),$(this,"removeOnDelete",i=>this.tableCache.removeOnDelete(i)),$(this,"onUpdate",i=>this.tableCache.onUpdate(i)),$(this,"removeOnUpdate",i=>this.tableCache.removeOnUpdate(i)),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}var li=Object.defineProperty,ui=(e,t,i)=>t in e?li(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,L=(e,t,i)=>(ui(e,typeof t!="symbol"?t+"":t,i),i);class di{constructor(t){L(this,"tableCache"),L(this,"id",{find:i=>{for(let s of this.tableCache.iter())if(Ht(s.id,i))return s}}),L(this,"onInsert",i=>this.tableCache.onInsert(i)),L(this,"removeOnInsert",i=>this.tableCache.removeOnInsert(i)),L(this,"onDelete",i=>this.tableCache.onDelete(i)),L(this,"removeOnDelete",i=>this.tableCache.removeOnDelete(i)),L(this,"onUpdate",i=>this.tableCache.onUpdate(i)),L(this,"removeOnUpdate",i=>this.tableCache.removeOnUpdate(i)),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}var yi=Object.defineProperty,hi=(e,t,i)=>t in e?yi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ge=(e,t,i)=>(hi(e,typeof t!="symbol"?t+"":t,i),i);class gi{constructor(t){ge(this,"tableCache"),ge(this,"onInsert",i=>this.tableCache.onInsert(i)),ge(this,"removeOnInsert",i=>this.tableCache.removeOnInsert(i)),ge(this,"onDelete",i=>this.tableCache.onDelete(i)),ge(this,"removeOnDelete",i=>this.tableCache.removeOnDelete(i)),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}var $e;(e=>{function t(){return c.createProductType([new p("id",c.createU256Type())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})($e||($e={}));var Le;(e=>{function t(){return c.createProductType([new p("id",c.createU256Type()),new p("check",c.createU256Type()),new p("left",c.createOptionType(c.createU256Type())),new p("right",c.createOptionType(c.createU256Type()))])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(Le||(Le={}));var Ot;(e=>{function t(){return c.createProductType([new p("name",c.createStringType())])}e.getTypeScriptAlgebraicType=t;function i(r,a){e.getTypeScriptAlgebraicType().serialize(r,a)}e.serialize=i;function s(r){return e.getTypeScriptAlgebraicType().deserialize(r)}e.deserialize=s})(Ot||(Ot={}));var Ti=Object.defineProperty,bi=(e,t,i)=>t in e?Ti(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,se=(e,t,i)=>(bi(e,typeof t!="symbol"?t+"":t,i),i);const Oe={tables:{item:{tableName:"item",rowType:$e.getTypeScriptAlgebraicType(),primaryKey:"id",primaryKeyInfo:{colName:"id",colType:$e.getTypeScriptAlgebraicType().product.elements[0].algebraicType}},merkle_tree:{tableName:"merkle_tree",rowType:Le.getTypeScriptAlgebraicType(),primaryKey:"id",primaryKeyInfo:{colName:"id",colType:Le.getTypeScriptAlgebraicType().product.elements[0].algebraicType}},person:{tableName:"person",rowType:Ot.getTypeScriptAlgebraicType()}},reducers:{add:{reducerName:"add",argsType:Ne.getTypeScriptAlgebraicType()},add_item:{reducerName:"add_item",argsType:De.getTypeScriptAlgebraicType()},add_tree:{reducerName:"add_tree",argsType:qe.getTypeScriptAlgebraicType()},identity_connected:{reducerName:"identity_connected",argsType:Et.getTypeScriptAlgebraicType()},identity_disconnected:{reducerName:"identity_disconnected",argsType:Pt.getTypeScriptAlgebraicType()},say_hello:{reducerName:"say_hello",argsType:xt.getTypeScriptAlgebraicType()}},versionInfo:{cliVersion:"1.2.0"},eventContextConstructor:(e,t)=>({...e,event:t}),dbViewConstructor:e=>new wi(e),reducersConstructor:(e,t)=>new fi(e,t),setReducerFlagsConstructor:()=>new mi};class fi{constructor(t,i){this.connection=t,this.setCallReducerFlags=i}add(t){const i={name:t};let s=new Z(1024);Ne.getTypeScriptAlgebraicType().serialize(s,i);let r=s.getBuffer();this.connection.callReducer("add",r,this.setCallReducerFlags.addFlags)}onAdd(t){this.connection.onReducer("add",t)}removeOnAdd(t){this.connection.offReducer("add",t)}addItem(t){const i={id:t};let s=new Z(1024);De.getTypeScriptAlgebraicType().serialize(s,i);let r=s.getBuffer();this.connection.callReducer("add_item",r,this.setCallReducerFlags.addItemFlags)}onAddItem(t){this.connection.onReducer("add_item",t)}removeOnAddItem(t){this.connection.offReducer("add_item",t)}addTree(t){const i={id:t};let s=new Z(1024);qe.getTypeScriptAlgebraicType().serialize(s,i);let r=s.getBuffer();this.connection.callReducer("add_tree",r,this.setCallReducerFlags.addTreeFlags)}onAddTree(t){this.connection.onReducer("add_tree",t)}removeOnAddTree(t){this.connection.offReducer("add_tree",t)}onIdentityConnected(t){this.connection.onReducer("identity_connected",t)}removeOnIdentityConnected(t){this.connection.offReducer("identity_connected",t)}onIdentityDisconnected(t){this.connection.onReducer("identity_disconnected",t)}removeOnIdentityDisconnected(t){this.connection.offReducer("identity_disconnected",t)}sayHello(){this.connection.callReducer("say_hello",new Uint8Array(0),this.setCallReducerFlags.sayHelloFlags)}onSayHello(t){this.connection.onReducer("say_hello",t)}removeOnSayHello(t){this.connection.offReducer("say_hello",t)}}class mi{constructor(){se(this,"addFlags","FullUpdate"),se(this,"addItemFlags","FullUpdate"),se(this,"addTreeFlags","FullUpdate"),se(this,"sayHelloFlags","FullUpdate")}add(t){this.addFlags=t}addItem(t){this.addItemFlags=t}addTree(t){this.addTreeFlags=t}sayHello(t){this.sayHelloFlags=t}}class wi{constructor(t){this.connection=t}get item(){return new pi(this.connection.clientCache.getOrCreateTable(Oe.tables.item))}get merkleTree(){return new di(this.connection.clientCache.getOrCreateTable(Oe.tables.merkle_tree))}get person(){return new gi(this.connection.clientCache.getOrCreateTable(Oe.tables.person))}}class Si extends lr{}class Tr extends ur{constructor(){super(...arguments),se(this,"subscriptionBuilder",()=>new Si(this))}}se(Tr,"builder",()=>new Gr(Oe,e=>e));const Ai="merklestore",Ii=window.location.pathname.split("/").includes("local")?"local":"remote",zi=Ii=="local"?"ws://localhost:3000":"wss://maincloud.spacetimedb.com",_i=()=>new Promise((e,t)=>{Tr.builder().withUri(zi).withModuleName(Ai).onConnect(i=>{i.subscriptionBuilder().onApplied(l=>console.log(l.db.merkleTree.id.find(0n))).onError(l=>console.error(l.event?.message)).subscribe("SELECT * FROM merkle_tree WHERE id = 0");const s=l=>new Promise((u,T)=>{i.subscriptionBuilder().onApplied(b=>u(b.db.item.id.find(l)!=null)).onError(b=>{console.error(b.event?.message),T(b.event?.message)}).subscribe(`SELECT * FROM item WHERE id = ${l}`)}),r=l=>new Promise((u,T)=>{console.log("finding",l),i.subscriptionBuilder().onApplied(async b=>{if(b.db.merkleTree.id.find(l)==null)return T("Tree not found");console.log("found",b.db.merkleTree.id.find(l))}).onError(b=>T(b.event?.message)).subscribe(`SELECT * FROM merkle_tree WHERE id = ${l}`)});e({checkHash:s,storeHash:l=>new Promise((u,T)=>{i.reducers.onAddItem((b,w)=>{console.log(b.event.status),u()}),i.reducers.addItem(l),i.reducers.onAddTree((b,w)=>{console.log("Tree added"),r(0n).then(console.log).catch(console.error)}),i.reducers.addTree(l)})})}).onConnectError(i=>t(i)).build()}),C=(e,t,i,s)=>{const r=document.createElement(e);return r.innerText=t,i&&r.classList.add(...i.split(".").filter(a=>a)),s&&Object.entries(s).forEach(([a,l])=>{a==="children"?l.forEach(u=>r.appendChild(u)):a==="eventListeners"?Object.entries(l).forEach(([u,T])=>{r.addEventListener(u,T)}):a==="color"||a==="background"?r.style[a]=l:a==="attributes"?Object.entries(l).forEach(([u,T])=>{r.setAttribute(u,T)}):r[a]=l}),r};async function Ui(e){const t=await e.arrayBuffer(),i=await crypto.subtle.digest("SHA-256",t),s=Array.from(new Uint8Array(i));return BigInt("0x"+s.map(r=>r.toString(16).padStart(2,"0")).join(""))}_i().then(e=>{function t(){const i=C("div","","upload-container",{children:[C("h2","Document Hasher","upload-title"),C("p","Select files to hash:","upload-description"),C("input","","file-input",{attributes:{type:"file",multiple:"true"}})]}),s=i.querySelector(".file-input"),r=C("div","","status-container"),a=C("div","","file-info");return s.addEventListener("change",async l=>{const u=l.target.files;if(!(!u||u.length===0)){r.innerHTML="";for(let T=0;T<u.length;T++){const b=u[T];try{const w=await Ui(b);a.innerHTML="";const z=C("div",b.name,"file-name"),U=C("div",`(${(b.size/1024).toFixed(2)} KB)`,"file-size"),E=C("div","","file-header",{children:[z,U]}),P=C("span","SHA-256: ","hash-label"),re=C("span",w.toString(),"hash-value"),Ce=C("div","","hash-container",{children:[P,re]});a.appendChild(E),a.appendChild(Ce);const X=C("div","","check-info");a.appendChild(X);const br=C("button","Check","action-button.check-button",{eventListeners:{click:async()=>{const Be=await e.checkHash(w),wr=C("div",Be?"✓ Exists":"✗ Does not exist",`status-message.${Be?"exists":"not-exists"}`);X.insertBefore(wr,X.firstChild)}}}),fr=C("button","Store","action-button.store-button",{eventListeners:{click:async()=>{await e.storeHash(w).then(()=>{const Be=C("div","✓ Stored","status-message.stored");X.insertBefore(Be,X.firstChild)})}}}),mr=C("div","","button-group",{children:[br,fr]});a.appendChild(mr)}catch(w){const z=w instanceof Error?w.message:"Unknown error occurred";a.innerHTML="";const U=C("div",`Error: ${z}`,"error-message");a.appendChild(U)}r.appendChild(a)}}}),i.appendChild(r),i}document.body.appendChild(t())});
